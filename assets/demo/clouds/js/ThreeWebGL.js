var THREE=THREE||{};self.Int32Array||(self.Int32Array=Array,self.Float32Array=Array),THREE.Color=function(e){return void 0!==e&&this.setHex(e),this},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSV:function(e,t,i){var r,n,o;if(0==i)this.r=this.g=this.b=0;else switch(r=Math.floor(6*e),n=6*e-r,e=i*(1-t),o=i*(1-t*n),t=i*(1-t*(1-n)),r){case 1:this.r=o,this.g=i,this.b=e;break;case 2:this.r=e,this.g=i,this.b=t;break;case 3:this.r=e,this.g=o,this.b=i;break;case 4:this.r=t,this.g=e,this.b=i;break;case 5:this.r=i,this.g=e,this.b=o;break;case 6:case 0:this.r=i,this.g=t,this.b=e}return this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b},getContextStyle:function(){return"rgb("+Math.floor(255*this.r)+","+Math.floor(255*this.g)+","+Math.floor(255*this.b)+")"},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this},clone:function(){return new THREE.Vector2(this.x,this.y)},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;return t*t+(e=this.y-e.y)*e},setLength:function(e){return this.normalize().multiplyScalar(e)},equals:function(e){return e.x==this.x&&e.y==this.y}},THREE.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},multiply:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},multiplySelf:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},divideSelf:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e,this.z/=e):this.set(0,0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},cross:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},crossSelf:function(e){return this.set(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){return(new THREE.Vector3).sub(this,e).lengthSq()},setPositionFromMatrix:function(e){this.x=e.n14,this.y=e.n24,this.z=e.n34},setRotationFromMatrix:function(e){var t=Math.cos(this.y);this.y=Math.asin(e.n13),Math.abs(t)>1e-5?(this.x=Math.atan2(-e.n23/t,e.n33/t),this.z=Math.atan2(-e.n12/t,e.n11/t)):(this.x=0,this.z=Math.atan2(e.n21,e.n22))},isZero:function(){return this.lengthSq()<1e-4}},THREE.Vector4=function(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},copy:function(e){this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.z=this.y=this.x=0,this.w=1),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},THREE.Ray=function(e,t){this.origin=e||new THREE.Vector3,this.direction=t||new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,intersectScene:function(e){return this.intersectObjects(e.objects)},intersectObjects:function(e){var t,i,r=[];for(t=0,i=e.length;t<i;t++)Array.prototype.push.apply(r,this.intersectObject(e[t]));return r.sort((function(e,t){return e.distance-t.distance})),r},intersectObject:function(e){function t(e,t,i){var r;return(r=i.clone().subSelf(e).dot(t))<=0?null:(e=e.clone().addSelf(t.clone().multiplyScalar(r)),i.distanceTo(e))}function i(e,t,i,r){r=r.clone().subSelf(t),i=i.clone().subSelf(t);var n=e.clone().subSelf(t),o=(e=r.dot(r),t=r.dot(i),r=r.dot(n),i.dot(i));e=(e*(i=i.dot(n))-t*r)*(n=1/(e*o-t*t));return(o=(o*r-t*i)*n)>0&&e>0&&o+e<1}if(e instanceof THREE.Particle)return null==(m=t(this.origin,this.direction,e.matrixWorld.getPosition()))||m>e.scale.x?[]:[{distance:m,point:e.position,face:null,object:e}];if(e instanceof THREE.Mesh){if(null==(m=t(this.origin,this.direction,e.matrixWorld.getPosition()))||m>e.geometry.boundingSphere.radius*Math.max(e.scale.x,Math.max(e.scale.y,e.scale.z)))return[];var r,n,o,a,s,h,l,f,c,u,E=e.geometry,d=E.vertices,p=[],m=0;for(r=E.faces.length;m<r;m++)n=E.faces[m],c=this.origin.clone(),u=this.direction.clone(),(f=(o=(h=e.matrixWorld).multiplyVector3(n.centroid.clone()).subSelf(c)).dot(u))<=0||(o=h.multiplyVector3(d[n.a].position.clone()),a=h.multiplyVector3(d[n.b].position.clone()),s=h.multiplyVector3(d[n.c].position.clone()),h=n instanceof THREE.Face4?h.multiplyVector3(d[n.d].position.clone()):null,l=e.matrixRotationWorld.multiplyVector3(n.normal.clone()),f=u.dot(l),!e.doubleSided&&!(e.flipSided?f>0:f<0))||(f=l.dot((new THREE.Vector3).sub(o,c))/f,c=c.addSelf(u.multiplyScalar(f)),n instanceof THREE.Face3?i(c,o,a,s)&&(n={distance:this.origin.distanceTo(c),point:c,face:n,object:e},p.push(n)):n instanceof THREE.Face4&&(i(c,o,a,h)||i(c,a,s,h))&&(n={distance:this.origin.distanceTo(c),point:c,face:n,object:e},p.push(n)));return p.sort((function(e,t){return e.distance-t.distance})),p}return[]}},THREE.Rectangle=function(){function e(){o=r-t,a=n-i}var t,i,r,n,o,a,s=!0;this.getX=function(){return t},this.getY=function(){return i},this.getWidth=function(){return o},this.getHeight=function(){return a},this.getLeft=function(){return t},this.getTop=function(){return i},this.getRight=function(){return r},this.getBottom=function(){return n},this.set=function(o,a,h,l){s=!1,t=o,i=a,r=h,n=l,e()},this.addPoint=function(o,a){s?(s=!1,t=o,i=a,r=o,n=a):(t=t<o?t:o,i=i<a?i:a,r=r>o?r:o,n=n>a?n:a),e()},this.add3Points=function(o,a,h,l,f,c){s?(s=!1,t=o<h?o<f?o:f:h<f?h:f,i=a<l?a<c?a:c:l<c?l:c,r=o>h?o>f?o:f:h>f?h:f,n=a>l?a>c?a:c:l>c?l:c):(t=o<h?o<f?o<t?o:t:f<t?f:t:h<f?h<t?h:t:f<t?f:t,i=a<l?a<c?a<i?a:i:c<i?c:i:l<c?l<i?l:i:c<i?c:i,r=o>h?o>f?o>r?o:r:f>r?f:r:h>f?h>r?h:r:f>r?f:r,n=a>l?a>c?a>n?a:n:c>n?c:n:l>c?l>n?l:n:c>n?c:n),e()},this.addRectangle=function(o){s?(s=!1,t=o.getLeft(),i=o.getTop(),r=o.getRight(),n=o.getBottom()):(t=t<o.getLeft()?t:o.getLeft(),i=i<o.getTop()?i:o.getTop(),r=r>o.getRight()?r:o.getRight(),n=n>o.getBottom()?n:o.getBottom()),e()},this.inflate=function(o){t-=o,i-=o,r+=o,n+=o,e()},this.minSelf=function(o){t=t>o.getLeft()?t:o.getLeft(),i=i>o.getTop()?i:o.getTop(),r=r<o.getRight()?r:o.getRight(),n=n<o.getBottom()?n:o.getBottom(),e()},this.intersects=function(e){return Math.min(r,e.getRight())-Math.max(t,e.getLeft())>=0&&Math.min(n,e.getBottom())-Math.max(i,e.getTop())>=0},this.empty=function(){s=!0,n=r=i=t=0,e()},this.isEmpty=function(){return s}},THREE.Matrix3=function(){this.m=[]},THREE.Matrix3.prototype={constructor:THREE.Matrix3,transpose:function(){var e,t=this.m;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},transposeIntoArray:function(e){var t=this.m;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},THREE.Matrix4=function(e,t,i,r,n,o,a,s,h,l,f,c,u,E,d,p){this.set(void 0!==e?e:1,t||0,i||0,r||0,n||0,void 0!==o?o:1,a||0,s||0,h||0,l||0,void 0!==f?f:1,c||0,u||0,E||0,d||0,void 0!==p?p:1),this.flat=Array(16),this.m33=new THREE.Matrix3},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,i,r,n,o,a,s,h,l,f,c,u,E,d,p){return this.n11=e,this.n12=t,this.n13=i,this.n14=r,this.n21=n,this.n22=o,this.n23=a,this.n24=s,this.n31=h,this.n32=l,this.n33=f,this.n34=c,this.n41=u,this.n42=E,this.n43=d,this.n44=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.set(e.n11,e.n12,e.n13,e.n14,e.n21,e.n22,e.n23,e.n24,e.n31,e.n32,e.n33,e.n34,e.n41,e.n42,e.n43,e.n44),this},lookAt:function(e,t,i){var r=THREE.Matrix4.__v1,n=THREE.Matrix4.__v2,o=THREE.Matrix4.__v3;return o.sub(e,t).normalize(),0===o.length()&&(o.z=1),r.cross(i,o).normalize(),0===r.length()&&(o.x+=1e-4,r.cross(i,o).normalize()),n.cross(o,r).normalize(),this.n11=r.x,this.n12=n.x,this.n13=o.x,this.n21=r.y,this.n22=n.y,this.n23=o.y,this.n31=r.z,this.n32=n.z,this.n33=o.z,this},multiplyVector3:function(e){var t=e.x,i=e.y,r=e.z,n=1/(this.n41*t+this.n42*i+this.n43*r+this.n44);return e.x=(this.n11*t+this.n12*i+this.n13*r+this.n14)*n,e.y=(this.n21*t+this.n22*i+this.n23*r+this.n24)*n,e.z=(this.n31*t+this.n32*i+this.n33*r+this.n34)*n,e},multiplyVector4:function(e){var t=e.x,i=e.y,r=e.z,n=e.w;return e.x=this.n11*t+this.n12*i+this.n13*r+this.n14*n,e.y=this.n21*t+this.n22*i+this.n23*r+this.n24*n,e.z=this.n31*t+this.n32*i+this.n33*r+this.n34*n,e.w=this.n41*t+this.n42*i+this.n43*r+this.n44*n,e},rotateAxis:function(e){var t=e.x,i=e.y,r=e.z;return e.x=t*this.n11+i*this.n12+r*this.n13,e.y=t*this.n21+i*this.n22+r*this.n23,e.z=t*this.n31+i*this.n32+r*this.n33,e.normalize(),e},crossVector:function(e){var t=new THREE.Vector4;return t.x=this.n11*e.x+this.n12*e.y+this.n13*e.z+this.n14*e.w,t.y=this.n21*e.x+this.n22*e.y+this.n23*e.z+this.n24*e.w,t.z=this.n31*e.x+this.n32*e.y+this.n33*e.z+this.n34*e.w,t.w=e.w?this.n41*e.x+this.n42*e.y+this.n43*e.z+this.n44*e.w:1,t},multiply:function(e,t){var i=e.n11,r=e.n12,n=e.n13,o=e.n14,a=e.n21,s=e.n22,h=e.n23,l=e.n24,f=e.n31,c=e.n32,u=e.n33,E=e.n34,d=e.n41,p=e.n42,m=e.n43,g=e.n44,T=t.n11,_=t.n12,R=t.n13,v=t.n14,y=t.n21,x=t.n22,b=t.n23,H=t.n24,w=t.n31,M=t.n32,S=t.n33,A=t.n34,C=t.n41,F=t.n42,L=t.n43,B=t.n44;return this.n11=i*T+r*y+n*w+o*C,this.n12=i*_+r*x+n*M+o*F,this.n13=i*R+r*b+n*S+o*L,this.n14=i*v+r*H+n*A+o*B,this.n21=a*T+s*y+h*w+l*C,this.n22=a*_+s*x+h*M+l*F,this.n23=a*R+s*b+h*S+l*L,this.n24=a*v+s*H+h*A+l*B,this.n31=f*T+c*y+u*w+E*C,this.n32=f*_+c*x+u*M+E*F,this.n33=f*R+c*b+u*S+E*L,this.n34=f*v+c*H+u*A+E*B,this.n41=d*T+p*y+m*w+g*C,this.n42=d*_+p*x+m*M+g*F,this.n43=d*R+p*b+m*S+g*L,this.n44=d*v+p*H+m*A+g*B,this},multiplyToArray:function(e,t,i){return this.multiply(e,t),i[0]=this.n11,i[1]=this.n21,i[2]=this.n31,i[3]=this.n41,i[4]=this.n12,i[5]=this.n22,i[6]=this.n32,i[7]=this.n42,i[8]=this.n13,i[9]=this.n23,i[10]=this.n33,i[11]=this.n43,i[12]=this.n14,i[13]=this.n24,i[14]=this.n34,i[15]=this.n44,this},multiplySelf:function(e){return this.multiply(this,e),this},multiplyScalar:function(e){return this.n11*=e,this.n12*=e,this.n13*=e,this.n14*=e,this.n21*=e,this.n22*=e,this.n23*=e,this.n24*=e,this.n31*=e,this.n32*=e,this.n33*=e,this.n34*=e,this.n41*=e,this.n42*=e,this.n43*=e,this.n44*=e,this},determinant:function(){var e=this.n11,t=this.n12,i=this.n13,r=this.n14,n=this.n21,o=this.n22,a=this.n23,s=this.n24,h=this.n31,l=this.n32,f=this.n33,c=this.n34,u=this.n41,E=this.n42,d=this.n43,p=this.n44;return r*a*l*u-i*s*l*u-r*o*f*u+t*s*f*u+i*o*c*u-t*a*c*u-r*a*h*E+i*s*h*E+r*n*f*E-e*s*f*E-i*n*c*E+e*a*c*E+r*o*h*d-t*s*h*d-r*n*l*d+e*s*l*d+t*n*c*d-e*o*c*d-i*o*h*p+t*a*h*p+i*n*l*p-e*a*l*p-t*n*f*p+e*o*f*p},transpose:function(){var e;return e=this.n21,this.n21=this.n12,this.n12=e,e=this.n31,this.n31=this.n13,this.n13=e,e=this.n32,this.n32=this.n23,this.n23=e,e=this.n41,this.n41=this.n14,this.n14=e,e=this.n42,this.n42=this.n24,this.n24=e,e=this.n43,this.n43=this.n34,this.n43=e,this},clone:function(){var e=new THREE.Matrix4;return e.n11=this.n11,e.n12=this.n12,e.n13=this.n13,e.n14=this.n14,e.n21=this.n21,e.n22=this.n22,e.n23=this.n23,e.n24=this.n24,e.n31=this.n31,e.n32=this.n32,e.n33=this.n33,e.n34=this.n34,e.n41=this.n41,e.n42=this.n42,e.n43=this.n43,e.n44=this.n44,e},flatten:function(){return this.flat[0]=this.n11,this.flat[1]=this.n21,this.flat[2]=this.n31,this.flat[3]=this.n41,this.flat[4]=this.n12,this.flat[5]=this.n22,this.flat[6]=this.n32,this.flat[7]=this.n42,this.flat[8]=this.n13,this.flat[9]=this.n23,this.flat[10]=this.n33,this.flat[11]=this.n43,this.flat[12]=this.n14,this.flat[13]=this.n24,this.flat[14]=this.n34,this.flat[15]=this.n44,this.flat},flattenToArray:function(e){return e[0]=this.n11,e[1]=this.n21,e[2]=this.n31,e[3]=this.n41,e[4]=this.n12,e[5]=this.n22,e[6]=this.n32,e[7]=this.n42,e[8]=this.n13,e[9]=this.n23,e[10]=this.n33,e[11]=this.n43,e[12]=this.n14,e[13]=this.n24,e[14]=this.n34,e[15]=this.n44,e},flattenToArrayOffset:function(e,t){return e[t]=this.n11,e[t+1]=this.n21,e[t+2]=this.n31,e[t+3]=this.n41,e[t+4]=this.n12,e[t+5]=this.n22,e[t+6]=this.n32,e[t+7]=this.n42,e[t+8]=this.n13,e[t+9]=this.n23,e[t+10]=this.n33,e[t+11]=this.n43,e[t+12]=this.n14,e[t+13]=this.n24,e[t+14]=this.n34,e[t+15]=this.n44,e},setTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},setScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},setRotationX:function(e){var t=Math.cos(e);e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},setRotationY:function(e){var t=Math.cos(e);e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},setRotationZ:function(e){var t=Math.cos(e);e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},setRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,a=e.y,s=e.z,h=n*o,l=n*a;return this.set(h*o+i,h*a-r*s,h*s+r*a,0,h*a+r*s,l*a+i,l*s-r*o,0,h*s-r*a,l*s+r*o,n*s*s+i,0,0,0,0,1),this},setPosition:function(e){return this.n14=e.x,this.n24=e.y,this.n34=e.z,this},getPosition:function(){return this.position||(this.position=new THREE.Vector3),this.position.set(this.n14,this.n24,this.n34),this.position},getColumnX:function(){return this.columnX||(this.columnX=new THREE.Vector3),this.columnX.set(this.n11,this.n21,this.n31),this.columnX},getColumnY:function(){return this.columnY||(this.columnY=new THREE.Vector3),this.columnY.set(this.n12,this.n22,this.n32),this.columnY},getColumnZ:function(){return this.columnZ||(this.columnZ=new THREE.Vector3),this.columnZ.set(this.n13,this.n23,this.n33),this.columnZ},setRotationFromEuler:function(e,t){var i=e.x,r=e.y,n=e.z,o=Math.cos(i),a=(i=Math.sin(i),Math.cos(r)),s=(r=Math.sin(r),Math.cos(n));n=Math.sin(n);switch(t){case"YXZ":var h=a*s,l=a*n,f=r*s,c=r*n;this.n11=h+c*i,this.n12=f*i-l,this.n13=o*r,this.n21=o*n,this.n22=o*s,this.n23=-i,this.n31=l*i-f,this.n32=c+h*i,this.n33=o*a;break;case"ZXY":h=a*s,l=a*n,f=r*s,c=r*n,this.n11=h-c*i,this.n12=-o*n,this.n13=f+l*i,this.n21=l+f*i,this.n22=o*s,this.n23=c-h*i,this.n31=-o*r,this.n32=i,this.n33=o*a;break;case"ZYX":h=o*s,l=o*n,f=i*s,c=i*n,this.n11=a*s,this.n12=f*r-l,this.n13=h*r+c,this.n21=a*n,this.n22=c*r+h,this.n23=l*r-f,this.n31=-r,this.n32=i*a,this.n33=o*a;break;case"YZX":h=o*a,l=o*r,f=i*a,c=i*r,this.n11=a*s,this.n12=c-h*n,this.n13=f*n+l,this.n21=n,this.n22=o*s,this.n23=-i*s,this.n31=-r*s,this.n32=l*n+f,this.n33=h-c*n;break;case"XZY":h=o*a,l=o*r,f=i*a,c=i*r,this.n11=a*s,this.n12=-n,this.n13=r*s,this.n21=h*n+c,this.n22=o*s,this.n23=l*n-f,this.n31=f*n-l,this.n32=i*s,this.n33=c*n+h;break;default:h=o*s,l=o*n,f=i*s,c=i*n,this.n11=a*s,this.n12=-a*n,this.n13=r,this.n21=l+f*r,this.n22=h-c*r,this.n23=-i*a,this.n31=c-h*r,this.n32=f+l*r,this.n33=o*a}return this},setRotationFromQuaternion:function(e){var t=e.x,i=e.y,r=e.z,n=e.w,o=t+t,a=i+i,s=r+r,h=(e=t*o,t*a);t*=s;var l=i*a;return i*=s,r*=s,o*=n,a*=n,n*=s,this.n11=1-(l+r),this.n12=h-n,this.n13=t+a,this.n21=h+n,this.n22=1-(e+r),this.n23=i-o,this.n31=t-a,this.n32=i+o,this.n33=1-(e+l),this},scale:function(e){var t=e.x,i=e.y;e=e.z;return this.n11*=t,this.n12*=i,this.n13*=e,this.n21*=t,this.n22*=i,this.n23*=e,this.n31*=t,this.n32*=i,this.n33*=e,this.n41*=t,this.n42*=i,this.n43*=e,this},compose:function(e,t,i){var r=THREE.Matrix4.__m1,n=THREE.Matrix4.__m2;return r.identity(),r.setRotationFromQuaternion(t),n.setScale(i.x,i.y,i.z),this.multiply(r,n),this.n14=e.x,this.n24=e.y,this.n34=e.z,this},decompose:function(e,t,i){var r=THREE.Matrix4.__v1,n=THREE.Matrix4.__v2,o=THREE.Matrix4.__v3;return r.set(this.n11,this.n21,this.n31),n.set(this.n12,this.n22,this.n32),o.set(this.n13,this.n23,this.n33),e=e instanceof THREE.Vector3?e:new THREE.Vector3,t=t instanceof THREE.Quaternion?t:new THREE.Quaternion,(i=i instanceof THREE.Vector3?i:new THREE.Vector3).x=r.length(),i.y=n.length(),i.z=o.length(),e.x=this.n14,e.y=this.n24,e.z=this.n34,(r=THREE.Matrix4.__m1).copy(this),r.n11/=i.x,r.n21/=i.x,r.n31/=i.x,r.n12/=i.y,r.n22/=i.y,r.n32/=i.y,r.n13/=i.z,r.n23/=i.z,r.n33/=i.z,t.setFromRotationMatrix(r),[e,t,i]},extractPosition:function(e){this.n14=e.n14,this.n24=e.n24,this.n34=e.n34},extractRotation:function(e,t){var i=1/t.x,r=1/t.y,n=1/t.z;this.n11=e.n11*i,this.n21=e.n21*i,this.n31=e.n31*i,this.n12=e.n12*r,this.n22=e.n22*r,this.n32=e.n32*r,this.n13=e.n13*n,this.n23=e.n23*n,this.n33=e.n33*n}},THREE.Matrix4.makeInvert=function(e,t){var i=e.n11,r=e.n12,n=e.n13,o=e.n14,a=e.n21,s=e.n22,h=e.n23,l=e.n24,f=e.n31,c=e.n32,u=e.n33,E=e.n34,d=e.n41,p=e.n42,m=e.n43,g=e.n44;return void 0===t&&(t=new THREE.Matrix4),t.n11=h*E*p-l*u*p+l*c*m-s*E*m-h*c*g+s*u*g,t.n12=o*u*p-n*E*p-o*c*m+r*E*m+n*c*g-r*u*g,t.n13=n*l*p-o*h*p+o*s*m-r*l*m-n*s*g+r*h*g,t.n14=o*h*c-n*l*c-o*s*u+r*l*u+n*s*E-r*h*E,t.n21=l*u*d-h*E*d-l*f*m+a*E*m+h*f*g-a*u*g,t.n22=n*E*d-o*u*d+o*f*m-i*E*m-n*f*g+i*u*g,t.n23=o*h*d-n*l*d-o*a*m+i*l*m+n*a*g-i*h*g,t.n24=n*l*f-o*h*f+o*a*u-i*l*u-n*a*E+i*h*E,t.n31=s*E*d-l*c*d+l*f*p-a*E*p-s*f*g+a*c*g,t.n32=o*c*d-r*E*d-o*f*p+i*E*p+r*f*g-i*c*g,t.n33=n*l*d-o*s*d+o*a*p-i*l*p-r*a*g+i*s*g,t.n34=o*s*f-r*l*f-o*a*c+i*l*c+r*a*E-i*s*E,t.n41=h*c*d-s*u*d-h*f*p+a*u*p+s*f*m-a*c*m,t.n42=r*u*d-n*c*d+n*f*p-i*u*p-r*f*m+i*c*m,t.n43=n*s*d-r*h*d-n*a*p+i*h*p+r*a*m-i*s*m,t.n44=r*h*f-n*s*f+n*a*c-i*h*c-r*a*u+i*s*u,t.multiplyScalar(1/e.determinant()),t},THREE.Matrix4.makeInvert3x3=function(e){var t=e.m33,i=t.m,r=e.n33*e.n22-e.n32*e.n23,n=-e.n33*e.n21+e.n31*e.n23,o=e.n32*e.n21-e.n31*e.n22,a=-e.n33*e.n12+e.n32*e.n13,s=e.n33*e.n11-e.n31*e.n13,h=-e.n32*e.n11+e.n31*e.n12,l=e.n23*e.n12-e.n22*e.n13,f=-e.n23*e.n11+e.n21*e.n13,c=e.n22*e.n11-e.n21*e.n12;return e=1/(e=e.n11*r+e.n21*a+e.n31*l),i[0]=e*r,i[1]=e*n,i[2]=e*o,i[3]=e*a,i[4]=e*s,i[5]=e*h,i[6]=e*l,i[7]=e*f,i[8]=e*c,t},THREE.Matrix4.makeFrustum=function(e,t,i,r,n,o){var a;return(a=new THREE.Matrix4).n11=2*n/(t-e),a.n12=0,a.n13=(t+e)/(t-e),a.n14=0,a.n21=0,a.n22=2*n/(r-i),a.n23=(r+i)/(r-i),a.n24=0,a.n31=0,a.n32=0,a.n33=-(o+n)/(o-n),a.n34=-2*o*n/(o-n),a.n41=0,a.n42=0,a.n43=-1,a.n44=0,a},THREE.Matrix4.makePerspective=function(e,t,i,r){var n;return n=-(e=i*Math.tan(e*Math.PI/360)),THREE.Matrix4.makeFrustum(n*t,e*t,n,e,i,r)},THREE.Matrix4.makeOrtho=function(e,t,i,r,n,o){var a,s,h,l;return s=t-e,h=i-r,l=o-n,(a=new THREE.Matrix4).n11=2/s,a.n12=0,a.n13=0,a.n14=-(t+e)/s,a.n21=0,a.n22=2/h,a.n23=0,a.n24=-(i+r)/h,a.n31=0,a.n32=0,a.n33=-2/l,a.n34=-(o+n)/l,a.n41=0,a.n42=0,a.n43=0,a.n44=1,a},THREE.Matrix4.__v1=new THREE.Vector3,THREE.Matrix4.__v2=new THREE.Vector3,THREE.Matrix4.__v3=new THREE.Vector3,THREE.Matrix4.__m1=new THREE.Matrix4,THREE.Matrix4.__m2=new THREE.Matrix4,THREE.Object3D=function(){this.name="",this.id=THREE.Object3DCount++,this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.eulerOrder="XYZ",this.scale=new THREE.Vector3(1,1,1),this.flipSided=this.doubleSided=this.dynamic=!1,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixRotationWorld=new THREE.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new THREE.Quaternion,this.useQuaternion=!1,this.boundRadius=0,this.boundRadiusScale=1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this._vector=new THREE.Vector3},THREE.Object3D.prototype={constructor:THREE.Object3D,translate:function(e,t){this.matrix.rotateAxis(t),this.position.addSelf(t.multiplyScalar(e))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},lookAt:function(e){this.matrix.lookAt(e,this.position,this.up),this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},add:function(e){if(-1===this.children.indexOf(e)){void 0!==e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.addChildRecurse(e)}},remove:function(e){var t=this,i=this.children.indexOf(e);if(-1!==i){for(e.parent=void 0,this.children.splice(i,1);void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.removeChildRecurse(e)}},getChildByName:function(e,t){var i,r,n;for(i=0,r=this.children.length;i<r;i++){if((n=this.children[i]).name===e)return n;if(t&&void 0!==(n=n.getChildByName(e,t)))return n}},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder),1===this.scale.x&&1===this.scale.y&&1===this.scale.z||(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))),this.matrixWorldNeedsUpdate=!0},update:function(e,t,i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(e?this.matrixWorld.multiply(e,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale),this.matrixWorldNeedsUpdate=!1,t=!0);e=0;for(var r=this.children.length;e<r;e++)this.children[e].update(this.matrixWorld,t,i)},addChild:function(e){this.add(e)},removeChild:function(e){this.remove(e)}},THREE.Object3DCount=0,THREE.Projector=function(){function e(){var e=p[a]=p[a]||new THREE.RenderableVertex;return a++,e}function t(e,t){return t.z-e.z}function i(e,t){var i=0,r=1,n=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return n>=0&&o>=0&&a>=0&&s>=0||!(n<0&&o<0||a<0&&s<0)&&(n<0?i=Math.max(i,n/(n-o)):o<0&&(r=Math.min(r,n/(n-o))),a<0?i=Math.max(i,a/(a-s)):s<0&&(r=Math.min(r,a/(a-s))),!(r<i)&&(e.lerpSelf(t,i),t.lerpSelf(e,1-r),!0))}var r,n,o,a,s,h,l,f,c,u,E,d=[],p=[],m=[],g=[],T=[],_=[],R=[],v=[],y=new THREE.Vector4,x=new THREE.Vector4,b=new THREE.Matrix4,H=new THREE.Matrix4,w=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],M=new THREE.Vector4,S=new THREE.Vector4;this.projectVector=function(e,t){return b.multiply(t.projectionMatrix,t.matrixWorldInverse),b.multiplyVector3(e),e},this.unprojectVector=function(e,t){return b.multiply(t.matrixWorld,THREE.Matrix4.makeInvert(t.projectionMatrix)),b.multiplyVector3(e),e},this.pickingRay=function(e,t){var i;return e.z=-1,i=new THREE.Vector3(e.x,e.y,1),this.unprojectVector(e,t),this.unprojectVector(i,t),i.subSelf(e).normalize(),new THREE.Ray(e,i)},this.projectObjects=function(e,i,o){var a,s;for(n=R.length=0,a=e.objects,e=0,i=a.length;e<i;e++){var h;if(!(h=!(s=a[e]).visible)&&(h=s instanceof THREE.Mesh)&&(h=s.frustumCulled)){e:{h=void 0;for(var l=s.matrixWorld,f=-s.geometry.boundingSphere.radius*Math.max(s.scale.x,Math.max(s.scale.y,s.scale.z)),c=0;c<6;c++)if((h=w[c].x*l.n14+w[c].y*l.n24+w[c].z*l.n34+w[c].w)<=f){h=!1;break e}h=!0}h=!h}h||(h=d[n]=d[n]||new THREE.RenderableObject,n++,r=h,y.copy(s.position),b.multiplyVector3(y),r.object=s,r.z=y.z,R.push(r))}return o&&R.sort(t),R},this.projectScene=function(r,n,d){var R,y,A,C,F,L,B,z,U,D,V,P,k,O,I,N,W,j=n.near,G=n.far;for(E=c=l=h=v.length=0,n.matrixAutoUpdate&&n.update(void 0,!0),r.update(void 0,!1,n),b.multiply(n.projectionMatrix,n.matrixWorldInverse),w[0].set(b.n41-b.n11,b.n42-b.n12,b.n43-b.n13,b.n44-b.n14),w[1].set(b.n41+b.n11,b.n42+b.n12,b.n43+b.n13,b.n44+b.n14),w[2].set(b.n41+b.n21,b.n42+b.n22,b.n43+b.n23,b.n44+b.n24),w[3].set(b.n41-b.n21,b.n42-b.n22,b.n43-b.n23,b.n44-b.n24),w[4].set(b.n41-b.n31,b.n42-b.n32,b.n43-b.n33,b.n44-b.n34),w[5].set(b.n41+b.n31,b.n42+b.n32,b.n43+b.n33,b.n44+b.n34),R=0;R<6;R++)(U=w[R]).divideScalar(Math.sqrt(U.x*U.x+U.y*U.y+U.z*U.z));for(U=this.projectObjects(r,n,!0),r=0,R=U.length;r<R;r++)if((D=U[r].object).visible)if(V=D.matrixWorld,P=D.matrixRotationWorld,k=D.materials,O=D.overdraw,a=0,D instanceof THREE.Mesh){for(C=(I=D.geometry).vertices,N=I.faces,I=I.faceVertexUvs,y=0,A=C.length;y<A;y++)(o=e()).positionWorld.copy(C[y].position),V.multiplyVector3(o.positionWorld),o.positionScreen.copy(o.positionWorld),b.multiplyVector4(o.positionScreen),o.positionScreen.x/=o.positionScreen.w,o.positionScreen.y/=o.positionScreen.w,o.visible=o.positionScreen.z>j&&o.positionScreen.z<G;for(C=0,y=N.length;C<y;C++){if((A=N[C])instanceof THREE.Face3){if(F=p[A.a],L=p[A.b],B=p[A.c],!(F.visible&&L.visible&&B.visible)||!D.doubleSided&&D.flipSided==(B.positionScreen.x-F.positionScreen.x)*(L.positionScreen.y-F.positionScreen.y)-(B.positionScreen.y-F.positionScreen.y)*(L.positionScreen.x-F.positionScreen.x)<0)continue;z=m[h]=m[h]||new THREE.RenderableFace3,h++,(s=z).v1.copy(F),s.v2.copy(L),s.v3.copy(B)}else if(A instanceof THREE.Face4){if(F=p[A.a],L=p[A.b],B=p[A.c],z=p[A.d],!(F.visible&&L.visible&&B.visible&&z.visible)||!D.doubleSided&&D.flipSided==((z.positionScreen.x-F.positionScreen.x)*(L.positionScreen.y-F.positionScreen.y)-(z.positionScreen.y-F.positionScreen.y)*(L.positionScreen.x-F.positionScreen.x)<0||(L.positionScreen.x-B.positionScreen.x)*(z.positionScreen.y-B.positionScreen.y)-(L.positionScreen.y-B.positionScreen.y)*(z.positionScreen.x-B.positionScreen.x)<0))continue;W=g[l]=g[l]||new THREE.RenderableFace4,l++,(s=W).v1.copy(F),s.v2.copy(L),s.v3.copy(B),s.v4.copy(z)}for(s.normalWorld.copy(A.normal),P.multiplyVector3(s.normalWorld),s.centroidWorld.copy(A.centroid),V.multiplyVector3(s.centroidWorld),s.centroidScreen.copy(s.centroidWorld),b.multiplyVector3(s.centroidScreen),F=0,L=(B=A.vertexNormals).length;F<L;F++)(z=s.vertexNormalsWorld[F]).copy(B[F]),P.multiplyVector3(z);for(F=0,L=I.length;F<L;F++)if(W=I[F][C])for(B=0,z=W.length;B<z;B++)s.uvs[F][B]=W[B];s.meshMaterials=k,s.faceMaterials=A.materials,s.overdraw=O,s.z=s.centroidScreen.z,v.push(s)}}else if(D instanceof THREE.Line)for(H.multiply(b,V),C=D.geometry.vertices,(F=e()).positionScreen.copy(C[0].position),H.multiplyVector4(F.positionScreen),y=1,A=C.length;y<A;y++)(F=e()).positionScreen.copy(C[y].position),H.multiplyVector4(F.positionScreen),L=p[a-2],M.copy(F.positionScreen),S.copy(L.positionScreen),i(M,S)&&(M.multiplyScalar(1/M.w),S.multiplyScalar(1/S.w),V=T[c]=T[c]||new THREE.RenderableLine,c++,(f=V).v1.positionScreen.copy(M),f.v2.positionScreen.copy(S),f.z=Math.max(M.z,S.z),f.materials=D.materials,v.push(f));else D instanceof THREE.Particle&&(x.set(D.matrixWorld.n14,D.matrixWorld.n24,D.matrixWorld.n34,1),b.multiplyVector4(x),x.z/=x.w,x.z>0&&x.z<1)&&(V=_[E]=_[E]||new THREE.RenderableParticle,E++,(u=V).x=x.x/x.w,u.y=x.y/x.w,u.z=x.z,u.rotation=D.rotation.z,u.scale.x=D.scale.x*Math.abs(u.x-(x.x+n.projectionMatrix.n11)/(x.w+n.projectionMatrix.n14)),u.scale.y=D.scale.y*Math.abs(u.y-(x.y+n.projectionMatrix.n22)/(x.w+n.projectionMatrix.n24)),u.materials=D.materials,v.push(u));return d&&v.sort(t),v}},THREE.Quaternion=function(e,t,i,r){this.set(e||0,t||0,i||0,void 0!==r?r:1)},THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e){var t=Math.PI/360,i=e.x*t,r=e.y*t,n=e.z*t,o=(e=Math.cos(r),r=Math.sin(r),t=Math.cos(-n),n=Math.sin(-n),Math.cos(i)),a=(i=Math.sin(i),e*t),s=r*n;return this.w=a*o-s*i,this.x=a*i+s*o,this.y=r*t*o+e*n*i,this.z=e*n*o-r*t*i,this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(i),this},setFromRotationMatrix:function(e){var t=Math.pow(e.determinant(),1/3);return this.w=Math.sqrt(Math.max(0,t+e.n11+e.n22+e.n33))/2,this.x=Math.sqrt(Math.max(0,t+e.n11-e.n22-e.n33))/2,this.y=Math.sqrt(Math.max(0,t-e.n11+e.n22-e.n33))/2,this.z=Math.sqrt(Math.max(0,t-e.n11-e.n22+e.n33))/2,this.x=e.n32-e.n23<0?-Math.abs(this.x):Math.abs(this.x),this.y=e.n13-e.n31<0?-Math.abs(this.y):Math.abs(this.y),this.z=e.n21-e.n12<0?-Math.abs(this.z):Math.abs(this.z),this.normalize(),this},calculateW:function(){return this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z)),this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0==e?this.w=this.z=this.y=this.x=0:(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this},multiplySelf:function(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=e.x,a=e.y,s=e.z;e=e.w;return this.x=t*e+n*o+i*s-r*a,this.y=i*e+n*a+r*o-t*s,this.z=r*e+n*s+t*a-i*o,this.w=n*e-t*o-i*a-r*s,this},multiply:function(e,t){return this.x=e.x*t.w+e.y*t.z-e.z*t.y+e.w*t.x,this.y=-e.x*t.z+e.y*t.w+e.z*t.x+e.w*t.y,this.z=e.x*t.y-e.y*t.x+e.z*t.w+e.w*t.z,this.w=-e.x*t.x-e.y*t.y-e.z*t.z+e.w*t.w,this},multiplyVector3:function(e,t){t||(t=e);var i=e.x,r=e.y,n=e.z,o=this.x,a=this.y,s=this.z,h=this.w,l=h*i+a*n-s*r,f=h*r+s*i-o*n,c=h*n+o*r-a*i;i=-o*i-a*r-s*n;return t.x=l*h+i*-o+f*-s-c*-a,t.y=f*h+i*-a+c*-o-l*-s,t.z=c*h+i*-s+l*-a-f*-o,t}},THREE.Quaternion.slerp=function(e,t,i,r){var n=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(Math.abs(n)>=1)return i.w=e.w,i.x=e.x,i.y=e.y,i.z=e.z,i;var o=Math.acos(n),a=Math.sqrt(1-n*n);return Math.abs(a)<.001?(i.w=.5*(e.w+t.w),i.x=.5*(e.x+t.x),i.y=.5*(e.y+t.y),i.z=.5*(e.z+t.z),i):(n=Math.sin((1-r)*o)/a,r=Math.sin(r*o)/a,i.w=e.w*n+t.w*r,i.x=e.x*n+t.x*r,i.y=e.y*n+t.y*r,i.z=e.z*n+t.z*r,i)},THREE.Vertex=function(e){this.position=e||new THREE.Vector3},THREE.Face3=function(e,t,i,r,n,o){this.a=e,this.b=t,this.c=i,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=n instanceof THREE.Color?n:new THREE.Color,this.vertexColors=n instanceof Array?n:[],this.vertexTangents=[],this.materials=o instanceof Array?o:[o],this.centroid=new THREE.Vector3},THREE.Face4=function(e,t,i,r,n,o,a){this.a=e,this.b=t,this.c=i,this.d=r,this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=o instanceof THREE.Color?o:new THREE.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],
this.materials=a instanceof Array?a:[a],this.centroid=new THREE.Vector3},THREE.UV=function(e,t){this.u=e||0,this.v=t||0},THREE.UV.prototype={constructor:THREE.UV,set:function(e,t){return this.u=e,this.v=t,this},copy:function(e){return this.u=e.u,this.v=e.v,this},clone:function(){return new THREE.UV(this.u,this.v)}},THREE.Geometry=function(){this.id=THREE.GeometryCount++,this.vertices=[],this.colors=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.dynamic=this.hasTangents=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){var t=new THREE.Matrix4;t.extractRotation(e,new THREE.Vector3(1,1,1));for(var i=0,r=this.vertices.length;i<r;i++)e.multiplyVector3(this.vertices[i].position);for(i=0,r=this.faces.length;i<r;i++){var n=this.faces[i];t.multiplyVector3(n.normal);for(var o=0,a=n.vertexNormals.length;o<a;o++)t.multiplyVector3(n.vertexNormals[o]);e.multiplyVector3(n.centroid)}},computeCentroids:function(){var e,t,i;for(e=0,t=this.faces.length;e<t;e++)(i=this.faces[e]).centroid.set(0,0,0),i instanceof THREE.Face3?(i.centroid.addSelf(this.vertices[i.a].position),i.centroid.addSelf(this.vertices[i.b].position),i.centroid.addSelf(this.vertices[i.c].position),i.centroid.divideScalar(3)):i instanceof THREE.Face4&&(i.centroid.addSelf(this.vertices[i.a].position),i.centroid.addSelf(this.vertices[i.b].position),i.centroid.addSelf(this.vertices[i.c].position),i.centroid.addSelf(this.vertices[i.d].position),i.centroid.divideScalar(4))},computeFaceNormals:function(e){var t,i,r,n,o,a,s=new THREE.Vector3,h=new THREE.Vector3;for(r=0,n=this.faces.length;r<n;r++){if(o=this.faces[r],e&&o.vertexNormals.length){for(s.set(0,0,0),t=0,i=o.vertexNormals.length;t<i;t++)s.addSelf(o.vertexNormals[t]);s.divideScalar(3)}else t=this.vertices[o.a],i=this.vertices[o.b],a=this.vertices[o.c],s.sub(a.position,i.position),h.sub(t.position,i.position),s.crossSelf(h);s.isZero()||s.normalize(),o.normal.copy(s)}},computeVertexNormals:function(){var e,t,i,r;if(null==this.__tmpVertices){for(r=this.__tmpVertices=Array(this.vertices.length),e=0,t=this.vertices.length;e<t;e++)r[e]=new THREE.Vector3;for(e=0,t=this.faces.length;e<t;e++)(i=this.faces[e])instanceof THREE.Face3?i.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]:i instanceof THREE.Face4&&(i.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3])}else for(r=this.__tmpVertices,e=0,t=this.vertices.length;e<t;e++)r[e].set(0,0,0);for(e=0,t=this.faces.length;e<t;e++)(i=this.faces[e])instanceof THREE.Face3?(r[i.a].addSelf(i.normal),r[i.b].addSelf(i.normal),r[i.c].addSelf(i.normal)):i instanceof THREE.Face4&&(r[i.a].addSelf(i.normal),r[i.b].addSelf(i.normal),r[i.c].addSelf(i.normal),r[i.d].addSelf(i.normal));for(e=0,t=this.vertices.length;e<t;e++)r[e].normalize();for(e=0,t=this.faces.length;e<t;e++)(i=this.faces[e])instanceof THREE.Face3?(i.vertexNormals[0].copy(r[i.a]),i.vertexNormals[1].copy(r[i.b]),i.vertexNormals[2].copy(r[i.c])):i instanceof THREE.Face4&&(i.vertexNormals[0].copy(r[i.a]),i.vertexNormals[1].copy(r[i.b]),i.vertexNormals[2].copy(r[i.c]),i.vertexNormals[3].copy(r[i.d]))},computeTangents:function(){function e(e,t,i,r,n,o,b){s=e.vertices[t].position,h=e.vertices[i].position,l=e.vertices[r].position,f=a[n],c=a[o],u=a[b],E=h.x-s.x,d=l.x-s.x,p=h.y-s.y,m=l.y-s.y,g=h.z-s.z,T=l.z-s.z,_=c.u-f.u,R=u.u-f.u,v=c.v-f.v,y=u.v-f.v,x=1/(_*y-R*v),M.set((y*E-v*d)*x,(y*p-v*m)*x,(y*g-v*T)*x),S.set((_*d-R*E)*x,(_*m-R*p)*x,(_*T-R*g)*x),H[t].addSelf(M),H[i].addSelf(M),H[r].addSelf(M),w[t].addSelf(S),w[i].addSelf(S),w[r].addSelf(S)}var t,i,r,n,o,a,s,h,l,f,c,u,E,d,p,m,g,T,_,R,v,y,x,b,H=[],w=[],M=new THREE.Vector3,S=new THREE.Vector3,A=new THREE.Vector3,C=new THREE.Vector3,F=new THREE.Vector3;for(t=0,i=this.vertices.length;t<i;t++)H[t]=new THREE.Vector3,w[t]=new THREE.Vector3;for(t=0,i=this.faces.length;t<i;t++)o=this.faces[t],a=this.faceVertexUvs[0][t],o instanceof THREE.Face3?e(this,o.a,o.b,o.c,0,1,2):o instanceof THREE.Face4&&(e(this,o.a,o.b,o.c,0,1,2),e(this,o.a,o.b,o.d,0,1,3));var L=["a","b","c","d"];for(t=0,i=this.faces.length;t<i;t++)for(o=this.faces[t],r=0;r<o.vertexNormals.length;r++)F.copy(o.vertexNormals[r]),n=o[L[r]],b=H[n],A.copy(b),A.subSelf(F.multiplyScalar(F.dot(b))).normalize(),C.cross(o.vertexNormals[r],b),n=(n=C.dot(w[n]))<0?-1:1,o.vertexTangents[r]=new THREE.Vector4(A.x,A.y,A.z,n);this.hasTangents=!0},computeBoundingBox:function(){var e;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var t=1,i=this.vertices.length;t<i;t++)(e=this.vertices[t]).position.x<this.boundingBox.x[0]?this.boundingBox.x[0]=e.position.x:e.position.x>this.boundingBox.x[1]&&(this.boundingBox.x[1]=e.position.x),e.position.y<this.boundingBox.y[0]?this.boundingBox.y[0]=e.position.y:e.position.y>this.boundingBox.y[1]&&(this.boundingBox.y[1]=e.position.y),e.position.z<this.boundingBox.z[0]?this.boundingBox.z[0]=e.position.z:e.position.z>this.boundingBox.z[1]&&(this.boundingBox.z[1]=e.position.z)}},computeBoundingSphere:function(){for(var e=0,t=0,i=this.vertices.length;t<i;t++)e=Math.max(e,this.vertices[t].position.length());this.boundingSphere={radius:e}},mergeVertices:function(){var e,t,i,r={},n=[],o=[],a=Math.pow(10,4);for(t=0,i=this.vertices.length;t<i;t++)e=this.vertices[t].position,void 0===r[e=[Math.round(e.x*a),Math.round(e.y*a),Math.round(e.z*a)].join("_")]?(r[e]=t,n.push(this.vertices[t]),o[t]=n.length-1):o[t]=o[r[e]];for(t=0,i=this.faces.length;t<i;t++)(r=this.faces[t])instanceof THREE.Face3&&(r.a=o[r.a],r.b=o[r.b],r.c=o[r.c]),r instanceof THREE.Face4&&(r.a=o[r.a],r.b=o[r.b],r.c=o[r.c],r.d=o[r.d]);this.vertices=n}},THREE.GeometryCount=0,THREE.Spline=function(e){function t(e,t,i,r,n,o,a){return(2*(t-i)+(e=.5*(i-e))+(r=.5*(r-t)))*a+(-3*(t-i)-2*e-r)*o+e*n+t}this.points=e;var i,r,n,o,a,s,h,l,f,c=[],u={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,r=Math.floor(i),n=i-r,c[0]=0==r?r:r-1,c[1]=r,c[2]=r>this.points.length-2?r:r+1,c[3]=r>this.points.length-3?r:r+2,s=this.points[c[0]],h=this.points[c[1]],l=this.points[c[2]],f=this.points[c[3]],a=n*(o=n*n),u.x=t(s.x,h.x,l.x,f.x,n,o,a),u.y=t(s.y,h.y,l.y,f.y,n,o,a),u.z=t(s.z,h.z,l.z,f.z,n,o,a),u},this.getControlPointsArray=function(){var e,t,i=this.points.length,r=[];for(e=0;e<i;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,i,r=t=t=0,n=new THREE.Vector3,o=new THREE.Vector3,a=[],s=0;for(a[0]=0,e||(e=100),i=this.points.length*e,n.copy(this.points[0]),e=1;e<i;e++)t=e/i,position=this.getPoint(t),o.copy(position),s+=o.distanceTo(n),n.copy(position),t*=this.points.length-1,(t=Math.floor(t))!=r&&(a[t]=s,r=t);return a[a.length]=s,{chunks:a,total:s}},this.reparametrizeByArcLength=function(e){var t,i,r,n,o,a,s=[],h=new THREE.Vector3,l=this.getLength();for(s.push(h.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(i=l.chunks[t]-l.chunks[t-1],a=Math.ceil(e*i/l.total),n=(t-1)/(this.points.length-1),o=t/(this.points.length-1),i=1;i<a-1;i++)r=n+i*(1/a)*(o-n),position=this.getPoint(r),s.push(h.copy(position).clone());s.push(h.copy(this.points[t]).clone())}this.points=s}},THREE.Edge=function(e,t,i,r){this.vertices=[e,t],this.vertexIndices=[i,r],this.faces=[],this.faceIndices=[]},THREE.Camera=function(){if(arguments.length)return new THREE.PerspectiveCamera(arguments[0],arguments[1],arguments[2],arguments[3]);THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4},THREE.Camera.prototype=new THREE.Object3D,THREE.Camera.prototype.constructor=THREE.Camera,THREE.Camera.prototype.lookAt=function(e){this.matrix.lookAt(this.position,e,this.up),this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},THREE.Camera.prototype.update=function(e,t,i){for(this.matrixAutoUpdate&&this.updateMatrix(),(t||this.matrixWorldNeedsUpdate)&&(e?this.matrixWorld.multiply(e,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0,THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse)),e=0;e<this.children.length;e++)this.children[e].update(this.matrixWorld,t,i)},THREE.OrthographicCamera=function(e,t,i,r,n,o){THREE.Camera.call(this),this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=void 0!==n?n:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=new THREE.Camera,THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera,THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makeOrtho(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.PerspectiveCamera=function(e,t,i,r){THREE.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=new THREE.Camera,THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera,THREE.PerspectiveCamera.prototype.setLens=function(e,t){this.fov=2*Math.atan((void 0!==t?t:43.25)/(2*e)),this.fov*=180/Math.PI,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,r,n,o){this.fullWidth=e,this.fullHeight=t,this.x=i,this.y=r,this.width=n,this.height=o,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(this.fov*Math.PI/360)*this.near,i=e*(r=-t),r=(e=Math.abs(e*t-i),Math.abs(t-r));this.projectionMatrix=THREE.Matrix4.makeFrustum(i+this.x*e/this.fullWidth,i+(this.x+this.width)*e/this.fullWidth,t-(this.y+this.height)*r/this.fullHeight,t-this.y*r/this.fullHeight,this.near,this.far)}else this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=new THREE.Object3D,THREE.Light.prototype.constructor=THREE.Light,THREE.Light.prototype.supr=THREE.Object3D.prototype,THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=new THREE.Light,THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(e,t,i){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.PointLight=function(e,t,i){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,0,0),this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0},THREE.PointLight.prototype=new THREE.Light,THREE.PointLight.prototype.constructor=THREE.PointLight,THREE.SpotLight=function(e,t,i,r){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.castShadow=void 0!==r&&r},THREE.SpotLight.prototype=new THREE.Light,THREE.SpotLight.prototype.constructor=THREE.SpotLight,THREE.Material=function(e){this.name="",this.id=THREE.MaterialCount++,e=e||{},this.opacity=void 0!==e.opacity?e.opacity:1,this.transparent=void 0!==e.transparent&&e.transparent,this.blending=void 0!==e.blending?e.blending:THREE.NormalBlending,this.depthTest=void 0===e.depthTest||e.depthTest,this.depthWrite=void 0===e.depthWrite||e.depthWrite,this.polygonOffset=void 0!==e.polygonOffset&&e.polygonOffset,this.polygonOffsetFactor=void 0!==e.polygonOffsetFactor?e.polygonOffsetFactor:0,this.polygonOffsetUnits=void 0!==e.polygonOffsetUnits?e.polygonOffsetUnits:0,this.alphaTest=void 0!==e.alphaTest?e.alphaTest:0},THREE.MaterialCount=0,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NormalBlending=0,THREE.AdditiveBlending=1,THREE.SubtractiveBlending=2,THREE.MultiplyBlending=3,THREE.AdditiveAlphaBlending=4,THREE.LineBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.linewidth=void 0!==e.linewidth?e.linewidth:1,this.linecap=void 0!==e.linecap?e.linecap:"round",this.linejoin=void 0!==e.linejoin?e.linejoin:"round",this.vertexColors=!!e.vertexColors&&e.vertexColors,this.fog=void 0===e.fog||e.fog},THREE.LineBasicMaterial.prototype=new THREE.Material,THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial,THREE.MeshBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.fog=void 0===e.fog||e.fog,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.MeshBasicMaterial.prototype=new THREE.Material,THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial,THREE.MeshLambertMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.fog=void 0===e.fog||e.fog,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.MeshLambertMaterial.prototype=new THREE.Material,THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial,THREE.MeshPhongMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.ambient=void 0!==e.ambient?new THREE.Color(e.ambient):new THREE.Color(328965),this.specular=void 0!==e.specular?new THREE.Color(e.specular):new THREE.Color(1118481),this.shininess=void 0!==e.shininess?e.shininess:30,this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.fog=void 0===e.fog||e.fog,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.MeshPhongMaterial.prototype=new THREE.Material,THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial,THREE.MeshDepthMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1},THREE.MeshDepthMaterial.prototype=new THREE.Material,THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial,THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.shading=e.shading?e.shading:THREE.FlatShading,this.wireframe=!!e.wireframe&&e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth?e.wireframeLinewidth:1},THREE.MeshNormalMaterial.prototype=new THREE.Material,THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial,THREE.MeshFaceMaterial=function(){},THREE.MeshShaderMaterial=function(e){return new THREE.ShaderMaterial(e)},THREE.ParticleBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=void 0!==e.map?e.map:null,this.size=void 0!==e.size?e.size:1,this.sizeAttenuation=void 0===e.sizeAttenuation||e.sizeAttenuation,this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.fog=void 0===e.fog||e.fog},THREE.ParticleBasicMaterial.prototype=new THREE.Material,THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial,THREE.ShaderMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.fragmentShader=void 0!==e.fragmentShader?e.fragmentShader:"void main() {}",this.vertexShader=void 0!==e.vertexShader?e.vertexShader:"void main() {}",this.uniforms=void 0!==e.uniforms?e.uniforms:{},this.attributes=e.attributes,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.fog=void 0!==e.fog&&e.fog,this.lights=void 0!==e.lights&&e.lights,this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.ShaderMaterial.prototype=new THREE.Material,THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial,THREE.Texture=function(e,t,i,r,n,o){this.id=THREE.TextureCount++,this.image=e,this.mapping=void 0!==t?t:new THREE.UVMapping,this.wrapS=void 0!==i?i:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==n?n:THREE.LinearFilter,this.minFilter=void 0!==o?o:THREE.LinearMipMapLinearFilter,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.needsUpdate=!1},THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var e=new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return e.offset.copy(this.offset),e.repeat.copy(this.repeat),e}},THREE.TextureCount=0,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.LatitudeReflectionMapping=function(){},THREE.LatitudeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.UVMapping=function(){},THREE.RepeatWrapping=0,THREE.ClampToEdgeWrapping=1,THREE.MirroredRepeatWrapping=2,THREE.NearestFilter=3,THREE.NearestMipMapNearestFilter=4,THREE.NearestMipMapLinearFilter=5,THREE.LinearFilter=6,THREE.LinearMipMapNearestFilter=7,THREE.LinearMipMapLinearFilter=8,THREE.ByteType=9,THREE.UnsignedByteType=10,THREE.ShortType=11,THREE.UnsignedShortType=12,THREE.IntType=13,THREE.UnsignedIntType=14,THREE.FloatType=15,THREE.AlphaFormat=16,THREE.RGBFormat=17,THREE.RGBAFormat=18,THREE.LuminanceFormat=19,THREE.LuminanceAlphaFormat=20,THREE.DataTexture=function(e,t,i,r,n,o,a,s,h){THREE.Texture.call(this,null,n,o,a,s,h),this.image={data:e,width:t,height:i},this.format=void 0!==r?r:THREE.RGBAFormat},THREE.DataTexture.prototype=new THREE.Texture,THREE.DataTexture.prototype.constructor=THREE.DataTexture,THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture(this.data.slice(0),this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return e.offset.copy(this.offset),e.repeat.copy(this.repeat),e},THREE.Particle=function(e){THREE.Object3D.call(this),this.materials=e instanceof Array?e:[e]},THREE.Particle.prototype=new THREE.Object3D,THREE.Particle.prototype.constructor=THREE.Particle,THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.materials=t instanceof Array?t:[t],this.sortParticles=!1},THREE.ParticleSystem.prototype=new THREE.Object3D,THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem,THREE.Line=function(e,t,i){THREE.Object3D.call(this),this.geometry=e,this.materials=t instanceof Array?t:[t],this.type=null!=i?i:THREE.LineStrip},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=new THREE.Object3D,THREE.Line.prototype.constructor=THREE.Line,THREE.Mesh=function(e,t){if(THREE.Object3D.call(this),this.geometry=e,this.materials=t&&t.length?t:[t],this.overdraw=!1,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0;i<this.geometry.morphTargets.length;i++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[i].name]=i}},THREE.Mesh.prototype=new THREE.Object3D,THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.supr=THREE.Object3D.prototype,THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:0},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4,this.hasNoneBoneChildren=!1},THREE.Bone.prototype=new THREE.Object3D,THREE.Bone.prototype.constructor=THREE.Bone,THREE.Bone.prototype.supr=THREE.Object3D.prototype,THREE.Bone.prototype.update=function(e,t,i){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiply(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var r,n=this.children.length;if(this.hasNoneBoneChildren)for(this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix),r=0;r<n;r++)(e=this.children[r])instanceof THREE.Bone?e.update(this.skinMatrix,t,i):e.update(this.matrixWorld,!0,i);else for(r=0;r<n;r++)this.children[r].update(this.skinMatrix,t,i)},THREE.Bone.prototype.addChild=function(e){-1!==this.children.indexOf(e)||(void 0!==e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e),e instanceof THREE.Bone)||(this.hasNoneBoneChildren=!0)},THREE.SkinnedMesh=function(e,t){var i,r,n,o,a,s;if(THREE.Mesh.call(this,e,t),this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[],void 0!==this.geometry.bones){for(i=0;i<this.geometry.bones.length;i++)o=(n=this.geometry.bones[i]).pos,a=n.rotq,s=n.scl,(r=this.addBone()).name=n.name,r.position.set(o[0],o[1],o[2]),r.quaternion.set(a[0],a[1],a[2],a[3]),r.useQuaternion=!0,void 0!==s?r.scale.set(s[0],s[1],s[2]):r.scale.set(1,1,1);for(i=0;i<this.bones.length;i++)n=this.geometry.bones[i],r=this.bones[i],-1===n.parent?this.addChild(r):this.bones[n.parent].addChild(r);this.boneMatrices=new Float32Array(16*this.bones.length),this.pose()}},THREE.SkinnedMesh.prototype=new THREE.Mesh,THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh,THREE.SkinnedMesh.prototype.update=function(e,t,i){if(this.visible){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.matrixWorld.multiply(e,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var r,n=this.children.length;for(r=0;r<n;r++)(e=this.children[r])instanceof THREE.Bone?e.update(this.identityMatrix,!1,i):e.update(this.matrixWorld,t,i);for(i=this.bones.length,ba=this.bones,bm=this.boneMatrices,t=0;t<i;t++)ba[t].skinMatrix.flattenToArrayOffset(bm,16*t)}},THREE.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new THREE.Bone(this)),this.bones.push(e),e},THREE.SkinnedMesh.prototype.pose=function(){this.update(void 0,!0);for(var e,t=[],i=0;i<this.bones.length;i++)e=this.bones[i],t.push(THREE.Matrix4.makeInvert(e.skinMatrix)),e.skinMatrix.flattenToArrayOffset(this.boneMatrices,16*i);var r;if(void 0===this.geometry.skinVerticesA)for(this.geometry.skinVerticesA=[],this.geometry.skinVerticesB=[],e=0;e<this.geometry.skinIndices.length;e++){i=this.geometry.vertices[e].position;var n=this.geometry.skinIndices[e].x,o=this.geometry.skinIndices[e].y;r=new THREE.Vector3(i.x,i.y,i.z),this.geometry.skinVerticesA.push(t[n].multiplyVector3(r)),r=new THREE.Vector3(i.x,i.y,i.z),this.geometry.skinVerticesB.push(t[o].multiplyVector3(r)),this.geometry.skinWeights[e].x+this.geometry.skinWeights[e].y!==1&&(i=.5*(1-(this.geometry.skinWeights[e].x+this.geometry.skinWeights[e].y)),this.geometry.skinWeights[e].x+=i,this.geometry.skinWeights[e].y+=i)}},THREE.Ribbon=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.materials=t instanceof Array?t:[t]},THREE.Ribbon.prototype=new THREE.Object3D,THREE.Ribbon.prototype.constructor=THREE.Ribbon,THREE.LOD=function(){THREE.Object3D.call(this),this.LODs=[]},THREE.LOD.prototype=new THREE.Object3D,THREE.LOD.prototype.constructor=THREE.LOD,THREE.LOD.prototype.supr=THREE.Object3D.prototype,THREE.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0);t=Math.abs(t);for(var i=0;i<this.LODs.length&&!(t<this.LODs[i].visibleAtDistance);i++);this.LODs.splice(i,0,{visibleAtDistance:t,object3D:e}),this.add(e)},THREE.LOD.prototype.update=function(e,t,i){if(this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.matrixWorld.multiply(e,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0),this.LODs.length>1){e=-((e=i.matrixWorldInverse).n31*this.position.x+e.n32*this.position.y+e.n33*this.position.z+e.n34),this.LODs[0].object3D.visible=!0;for(var r=1;r<this.LODs.length&&e>=this.LODs[r].visibleAtDistance;r++)this.LODs[r-1].object3D.visible=!1,this.LODs[r].object3D.visible=!0;for(;r<this.LODs.length;r++)this.LODs[r].object3D.visible=!1}for(e=0;e<this.children.length;e++)this.children[e].update(this.matrixWorld,t,i)},THREE.Sprite=function(e){THREE.Object3D.call(this),this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=e.map instanceof THREE.Texture?e.map:THREE.ImageUtils.loadTexture(e.map),this.blending=void 0!==e.blending?e.blending:THREE.NormalBlending,this.useScreenCoordinates=void 0===e.useScreenCoordinates||e.useScreenCoordinates,this.mergeWith3D=void 0!==e.mergeWith3D?e.mergeWith3D:!this.useScreenCoordinates,this.affectedByDistance=void 0!==e.affectedByDistance?e.affectedByDistance:!this.useScreenCoordinates,this.scaleByViewport=void 0!==e.scaleByViewport?e.scaleByViewport:!this.affectedByDistance,this.alignment=e.alignment instanceof THREE.Vector2?e.alignment:THREE.SpriteAlignment.center,this.rotation3d=this.rotation,this.rotation=0,this.opacity=1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1)},THREE.Sprite.prototype=new THREE.Object3D,THREE.Sprite.prototype.constructor=THREE.Sprite,THREE.Sprite.prototype.supr=THREE.Object3D.prototype,THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),1===this.scale.x&&1===this.scale.y||(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)),this.matrixWorldNeedsUpdate=!0},THREE.SpriteAlignment={},THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1),THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1),THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1),THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0),THREE.SpriteAlignment.center=new THREE.Vector2(0,0),THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0),THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1),THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1),THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1),THREE.Scene=function(){THREE.Object3D.call(this),this.fog=null,this.matrixAutoUpdate=!1,this.collisions=this.overrideMaterial=null,this.objects=[],this.lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=new THREE.Object3D,THREE.Scene.prototype.constructor=THREE.Scene,THREE.Scene.prototype.supr=THREE.Object3D.prototype,THREE.Scene.prototype.add=function(e){this.supr.add.call(this,e),this.addChildRecurse(e)},THREE.Scene.prototype.addChildRecurse=function(e){if(e instanceof THREE.Light)-1===this.lights.indexOf(e)&&this.lights.push(e);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)&&-1===this.objects.indexOf(e)){this.objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}for(t=0;t<e.children.length;t++)this.addChildRecurse(e.children[t])},THREE.Scene.prototype.remove=function(e){this.supr.remove.call(this,e),this.removeChildRecurse(e)},THREE.Scene.prototype.removeChildRecurse=function(e){if(e instanceof THREE.Light){var t=this.lights.indexOf(e);-1!==t&&this.lights.splice(t,1)}else e instanceof THREE.Camera||-1!==(t=this.objects.indexOf(e))&&(this.objects.splice(t,1),this.__objectsRemoved.push(e),-1!==(t=this.__objectsAdded.indexOf(e))&&this.__objectsAdded.splice(t,1));for(t=0;t<e.children.length;t++)this.removeChildRecurse(e.children[t])},THREE.Scene.prototype.addChild=function(e){this.add(e)},THREE.Scene.prototype.addObject=function(e){this.add(e)},THREE.Scene.prototype.addLight=function(e){this.add(e)},THREE.Scene.prototype.removeChild=function(e){this.remove(e)},THREE.Scene.prototype.removeObject=function(e){this.remove(e)},THREE.Scene.prototype.removeLight=function(e){this.remove(e)},THREE.Fog=function(e,t,i){this.color=new THREE.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3},THREE.FogExp2=function(e,t){this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",
lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif",lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n}\n#endif\n}",lights_phong_pars_vertex:"#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif",lights_phong_vertex:"#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif",lights_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + viewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * pointDistance;\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * totalDiffuse + totalSpecular + ambientLightColor * ambient;",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform float shadowDarkness;\nuniform float shadowBias;\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_SOFT\nconst float xPixelOffset = 1.0 / SHADOWMAP_WIDTH;\nconst float yPixelOffset = 1.0 / SHADOWMAP_HEIGHT;\n#endif\nvec4 shadowColor = vec4( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nshadowCoord.z += shadowBias;\nif ( shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 ) {\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nfor ( float y = -1.25; y <= 1.25; y += 1.25 )\nfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\nvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadow += 1.0;\n}\nshadow /= 9.0;\nshadowColor = shadowColor * vec4( vec3( ( 1.0 - shadowDarkness * shadow ) ), 1.0 );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec4( vec3( shadowDarkness ), 1.0 );\n#endif\n}\n}\ngl_FragColor = gl_FragColor * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif"},THREE.UniformsUtils={merge:function(e){var t,i,r,n={};for(t=0;t<e.length;t++)for(i in r=this.clone(e[t]))n[i]=r[i];return n},clone:function(e){var t,i,r,n={};for(t in e)for(i in n[t]={},e[t])r=e[t][i],n[t][i]=r instanceof THREE.Color||r instanceof THREE.Vector2||r instanceof THREE.Vector3||r instanceof THREE.Vector4||r instanceof THREE.Matrix4||r instanceof THREE.Texture?r.clone():r instanceof Array?r.slice():r;return n}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:6,texture:[]},shadowMatrix:{type:"m4v",value:[]},shadowBias:{type:"f",value:.0039},shadowDarkness:{type:"f",value:.2}}},THREE.ShaderLib={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap]),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,"gl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}},THREE.WebGLRenderer=function(e){function t(e,t,i){var r,n,o,a,s,h=e.vertices,l=h.length,f=e.colors,c=f.length,u=e.__vertexArray,E=e.__colorArray,d=e.__sortArray,p=e.__dirtyVertices,m=e.__dirtyColors,g=e.__webglCustomAttributes;if(g)for(a in g)g[a].offset=0;if(i.sortParticles){for(te.multiplySelf(i.matrixWorld),r=0;r<l;r++)n=h[r].position,ne.copy(n),te.multiplyVector3(ne),d[r]=[ne.z,r];for(d.sort((function(e,t){return t[0]-e[0]})),r=0;r<l;r++)n=h[d[r][1]].position,u[o=3*r]=n.x,u[o+1]=n.y,u[o+2]=n.z;for(r=0;r<c;r++)o=3*r,color=f[d[r][1]],E[o]=color.r,E[o+1]=color.g,E[o+2]=color.b;if(g)for(a in g)for(f=(r=g[a]).value.length,o=0;o<f;o++)index=d[o][1],c=r.offset,1===r.size?void 0!==r.boundTo&&"vertices"!==r.boundTo||(r.array[c]=r.value[index]):(void 0!==r.boundTo&&"vertices"!==r.boundTo||(s=r.value[index]),2===r.size?(r.array[c]=s.x,r.array[c+1]=s.y):3===r.size?"c"===r.type?(r.array[c]=s.r,r.array[c+1]=s.g,r.array[c+2]=s.b):(r.array[c]=s.x,r.array[c+1]=s.y,r.array[c+2]=s.z):(r.array[c]=s.x,r.array[c+1]=s.y,r.array[c+2]=s.z,r.array[c+3]=s.w)),r.offset+=r.size}else{if(p)for(r=0;r<l;r++)n=h[r].position,u[o=3*r]=n.x,u[o+1]=n.y,u[o+2]=n.z;if(m)for(r=0;r<c;r++)color=f[r],E[o=3*r]=color.r,E[o+1]=color.g,E[o+2]=color.b;if(g)for(a in g)if((r=g[a]).__original.needsUpdate)for(f=r.value.length,o=0;o<f;o++)c=r.offset,1===r.size?void 0!==r.boundTo&&"vertices"!==r.boundTo||(r.array[c]=r.value[o]):(void 0!==r.boundTo&&"vertices"!==r.boundTo||(s=r.value[o]),2===r.size?(r.array[c]=s.x,r.array[c+1]=s.y):3===r.size?"c"===r.type?(r.array[c]=s.r,r.array[c+1]=s.g,r.array[c+2]=s.b):(r.array[c]=s.x,r.array[c+1]=s.y,r.array[c+2]=s.z):(r.array[c]=s.x,r.array[c+1]=s.y,r.array[c+2]=s.z,r.array[c+3]=s.w)),r.offset+=r.size}if((p||i.sortParticles)&&(z.bindBuffer(z.ARRAY_BUFFER,e.__webglVertexBuffer),z.bufferData(z.ARRAY_BUFFER,u,t)),(m||i.sortParticles)&&(z.bindBuffer(z.ARRAY_BUFFER,e.__webglColorBuffer),z.bufferData(z.ARRAY_BUFFER,E,t)),g)for(a in g)((r=g[a]).__original.needsUpdate||i.sortParticles)&&(z.bindBuffer(z.ARRAY_BUFFER,r.buffer),z.bufferData(z.ARRAY_BUFFER,r.array,t))}function i(e,t,i,r,n){if(r.program||U.initMaterial(r,t,i,n),r.morphTargets&&!n.__webglMorphTargetInfluences){n.__webglMorphTargetInfluences=new Float32Array(U.maxMorphTargets);for(var o=0,a=U.maxMorphTargets;o<a;o++)n.__webglMorphTargetInfluences[o]=0}var s=!1,h=(a=(o=r.program).uniforms,r.uniforms);if(o!=V&&(z.useProgram(o),V=o,s=!0),r.id!=k&&(k=r.id,s=!0),s){if(z.uniformMatrix4fv(a.projectionMatrix,!1,ie),i&&r.fog&&(h.fogColor.value=i.color,i instanceof THREE.Fog?(h.fogNear.value=i.near,h.fogFar.value=i.far):i instanceof THREE.FogExp2&&(h.fogDensity.value=i.density)),r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights){var l,f,c,u,E,d=0,p=0,m=0,g=oe,T=g.directional.colors,_=g.directional.positions,R=g.point.colors,v=g.point.positions,y=g.point.distances,x=0,b=0;for(i=l=E=0,s=t.length;i<s;i++)f=(l=t[i]).color,c=l.position,u=l.intensity,E=l.distance,l instanceof THREE.AmbientLight?(d+=f.r,p+=f.g,m+=f.b):l instanceof THREE.DirectionalLight?(T[E=3*x]=f.r*u,T[E+1]=f.g*u,T[E+2]=f.b*u,_[E]=c.x,_[E+1]=c.y,_[E+2]=c.z,x+=1):l instanceof THREE.SpotLight?(T[E=3*x]=f.r*u,T[E+1]=f.g*u,T[E+2]=f.b*u,f=1/c.length(),_[E]=c.x*f,_[E+1]=c.y*f,_[E+2]=c.z*f,x+=1):l instanceof THREE.PointLight&&(R[l=3*b]=f.r*u,R[l+1]=f.g*u,R[l+2]=f.b*u,v[l]=c.x,v[l+1]=c.y,v[l+2]=c.z,y[b]=E,b+=1);for(i=3*x,s=T.length;i<s;i++)T[i]=0;for(i=3*b,s=R.length;i<s;i++)R[i]=0;g.point.length=b,g.directional.length=x,g.ambient[0]=d,g.ambient[1]=p,g.ambient[2]=m,t=oe,h.enableLighting.value=t.directional.length+t.point.length,h.ambientLightColor.value=t.ambient,h.directionalLightColor.value=t.directional.colors,h.directionalLightDirection.value=t.directional.positions,h.pointLightColor.value=t.point.colors,h.pointLightPosition.value=t.point.positions,h.pointLightDistance.value=t.point.distances}if((r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial)&&(h.diffuse.value=r.color,h.opacity.value=r.opacity,(h.map.texture=r.map)&&h.offsetRepeat.value.set(r.map.offset.x,r.map.offset.y,r.map.repeat.x,r.map.repeat.y),h.lightMap.texture=r.lightMap,h.envMap.texture=r.envMap,h.reflectivity.value=r.reflectivity,h.refractionRatio.value=r.refractionRatio,h.combine.value=r.combine,h.useRefract.value=r.envMap&&r.envMap.mapping instanceof THREE.CubeRefractionMapping),r instanceof THREE.LineBasicMaterial?(h.diffuse.value=r.color,h.opacity.value=r.opacity):r instanceof THREE.ParticleBasicMaterial?(h.psColor.value=r.color,h.opacity.value=r.opacity,h.size.value=r.size,h.scale.value=ae.height/2,h.map.texture=r.map):r instanceof THREE.MeshPhongMaterial?(h.ambient.value=r.ambient,h.specular.value=r.specular,h.shininess.value=r.shininess):r instanceof THREE.MeshDepthMaterial?(h.mNear.value=e.near,h.mFar.value=e.far,h.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(h.opacity.value=r.opacity),n.receiveShadow&&!r._shadowPass&&h.shadowMatrix){for(t=0;t<de.length;t++)h.shadowMatrix.value[t]=de[t],h.shadowMap.texture[t]=U.shadowMap[t];h.shadowDarkness.value=U.shadowMapDarkness,h.shadowBias.value=U.shadowMapBias}for(h=0,i=(t=r.uniformsList).length;h<i;h++)if(p=o.uniforms[t[h][1]])if(m=(d=t[h][0]).type,s=d.value,"i"==m)z.uniform1i(p,s);else if("f"==m)z.uniform1f(p,s);else if("v2"==m)z.uniform2f(p,s.x,s.y);else if("v3"==m)z.uniform3f(p,s.x,s.y,s.z);else if("v4"==m)z.uniform4f(p,s.x,s.y,s.z,s.w);else if("c"==m)z.uniform3f(p,s.r,s.g,s.b);else if("fv1"==m)z.uniform1fv(p,s);else if("fv"==m)z.uniform3fv(p,s);else if("v3v"==m){for(d._array||(d._array=new Float32Array(3*s.length)),m=0,c=s.length;m<c;m++)g=3*m,d._array[g]=s[m].x,d._array[g+1]=s[m].y,d._array[g+2]=s[m].z;z.uniform3fv(p,d._array)}else if("m4"==m)d._array||(d._array=new Float32Array(16)),s.flattenToArray(d._array),z.uniformMatrix4fv(p,!1,d._array);else if("m4v"==m){for(d._array||(d._array=new Float32Array(16*s.length)),m=0,c=s.length;m<c;m++)s[m].flattenToArrayOffset(d._array,16*m);z.uniformMatrix4fv(p,!1,d._array)}else if("t"==m){if(z.uniform1i(p,s),p=d.texture)if(p.image instanceof Array&&6==p.image.length){if(6==(d=p).image.length)if(d.needsUpdate){for(d.image.__webglTextureCube||(d.image.__webglTextureCube=z.createTexture()),z.activeTexture(z.TEXTURE0+s),z.bindTexture(z.TEXTURE_CUBE_MAP,d.image.__webglTextureCube),s=0;s<6;s++)z.texImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,d.image[s]);M(z.TEXTURE_CUBE_MAP,d,d.image[0]),d.needsUpdate=!1}else z.activeTexture(z.TEXTURE0+s),z.bindTexture(z.TEXTURE_CUBE_MAP,d.image.__webglTextureCube)}else p instanceof THREE.WebGLRenderTargetCube?(d=p,z.activeTexture(z.TEXTURE0+s),z.bindTexture(z.TEXTURE_CUBE_MAP,d.__webglTexture)):S(p,s)}else if("tv"==m){if(!d._array)for(d._array=[],m=0,c=d.texture.length;m<c;m++)d._array[m]=s+m;for(z.uniform1iv(p,d._array),m=0,c=d.texture.length;m<c;m++)(p=d.texture[m])&&S(p,d._array[m])}(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&null!==a.cameraPosition&&z.uniform3f(a.cameraPosition,e.position.x,e.position.y,e.position.z),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&null!==a.viewMatrix&&z.uniformMatrix4fv(a.viewMatrix,!1,re),r.skinning&&(z.uniformMatrix4fv(a.cameraInverseMatrix,!1,re),z.uniformMatrix4fv(a.boneGlobalMatrices,!1,n.boneMatrices))}return z.uniformMatrix4fv(a.modelViewMatrix,!1,n._modelViewMatrixArray),a.normalMatrix&&z.uniformMatrix3fv(a.normalMatrix,!1,n._normalMatrixArray),(r instanceof THREE.ShaderMaterial||r.envMap||r.skinning||n.receiveShadow)&&null!==a.objectMatrix&&z.uniformMatrix4fv(a.objectMatrix,!1,n._objectMatrixArray),o}function r(e,t,r,n,o,a){if(0!=n.opacity){var s;e=(r=i(e,t,r,n,a)).attributes,t=!1;if((r=16777215*o.id+r.id)!=O&&(O=r,t=!0),!n.morphTargets&&e.position>=0)t&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglVertexBuffer),z.vertexAttribPointer(e.position,3,z.FLOAT,!1,0,0));else if(a.morphTargetBase){if(r=n.program.attributes,-1!==a.morphTargetBase?(z.bindBuffer(z.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[a.morphTargetBase]),z.vertexAttribPointer(r.position,3,z.FLOAT,!1,0,0)):r.position>=0&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglVertexBuffer),z.vertexAttribPointer(r.position,3,z.FLOAT,!1,0,0)),a.morphTargetForcedOrder.length)for(var h=0,l=a.morphTargetForcedOrder,f=a.morphTargetInfluences;h<n.numSupportedMorphTargets&&h<l.length;)z.bindBuffer(z.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[l[h]]),z.vertexAttribPointer(r["morphTarget"+h],3,z.FLOAT,!1,0,0),a.__webglMorphTargetInfluences[h]=f[l[h]],h++;else{l=[];var c,u=-1,E=0,d=(f=a.morphTargetInfluences).length;h=0;for(-1!==a.morphTargetBase&&(l[a.morphTargetBase]=!0);h<n.numSupportedMorphTargets;){for(c=0;c<d;c++)!l[c]&&f[c]>u&&(u=f[E=c]);z.bindBuffer(z.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[E]),z.vertexAttribPointer(r["morphTarget"+h],3,z.FLOAT,!1,0,0),a.__webglMorphTargetInfluences[h]=u,l[E]=1,u=-1,h++}}null!==n.program.uniforms.morphTargetInfluences&&z.uniform1fv(n.program.uniforms.morphTargetInfluences,a.__webglMorphTargetInfluences)}if(t){if(o.__webglCustomAttributes)for(s in o.__webglCustomAttributes)e[s]>=0&&(r=o.__webglCustomAttributes[s],z.bindBuffer(z.ARRAY_BUFFER,r.buffer),z.vertexAttribPointer(e[s],r.size,z.FLOAT,!1,0,0));e.color>=0&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglColorBuffer),z.vertexAttribPointer(e.color,3,z.FLOAT,!1,0,0)),e.normal>=0&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglNormalBuffer),z.vertexAttribPointer(e.normal,3,z.FLOAT,!1,0,0)),e.tangent>=0&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglTangentBuffer),z.vertexAttribPointer(e.tangent,4,z.FLOAT,!1,0,0)),e.uv>=0&&(o.__webglUVBuffer?(z.bindBuffer(z.ARRAY_BUFFER,o.__webglUVBuffer),z.vertexAttribPointer(e.uv,2,z.FLOAT,!1,0,0),z.enableVertexAttribArray(e.uv)):z.disableVertexAttribArray(e.uv)),e.uv2>=0&&(o.__webglUV2Buffer?(z.bindBuffer(z.ARRAY_BUFFER,o.__webglUV2Buffer),z.vertexAttribPointer(e.uv2,2,z.FLOAT,!1,0,0),z.enableVertexAttribArray(e.uv2)):z.disableVertexAttribArray(e.uv2)),n.skinning&&e.skinVertexA>=0&&e.skinVertexB>=0&&e.skinIndex>=0&&e.skinWeight>=0&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglSkinVertexABuffer),z.vertexAttribPointer(e.skinVertexA,4,z.FLOAT,!1,0,0),z.bindBuffer(z.ARRAY_BUFFER,o.__webglSkinVertexBBuffer),z.vertexAttribPointer(e.skinVertexB,4,z.FLOAT,!1,0,0),z.bindBuffer(z.ARRAY_BUFFER,o.__webglSkinIndicesBuffer),z.vertexAttribPointer(e.skinIndex,4,z.FLOAT,!1,0,0),z.bindBuffer(z.ARRAY_BUFFER,o.__webglSkinWeightsBuffer),z.vertexAttribPointer(e.skinWeight,4,z.FLOAT,!1,0,0))}a instanceof THREE.Mesh?(n.wireframe?(z.lineWidth(n.wireframeLinewidth),t&&z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),z.drawElements(z.LINES,o.__webglLineCount,z.UNSIGNED_SHORT,0)):(t&&z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),z.drawElements(z.TRIANGLES,o.__webglFaceCount,z.UNSIGNED_SHORT,0)),U.info.render.calls++,U.info.render.vertices+=o.__webglFaceCount,U.info.render.faces+=o.__webglFaceCount/3):a instanceof THREE.Line?(a=a.type==THREE.LineStrip?z.LINE_STRIP:z.LINES,z.lineWidth(n.linewidth),z.drawArrays(a,0,o.__webglLineCount),U.info.render.calls++):a instanceof THREE.ParticleSystem?(z.drawArrays(z.POINTS,0,o.__webglParticleCount),U.info.render.calls++):a instanceof THREE.Ribbon&&(z.drawArrays(z.TRIANGLE_STRIP,0,o.__webglVertexCount),U.info.render.calls++)}}function n(e,t,i){if(e.__webglVertexBuffer||(e.__webglVertexBuffer=z.createBuffer()),e.__webglNormalBuffer||(e.__webglNormalBuffer=z.createBuffer()),e.hasPos&&(z.bindBuffer(z.ARRAY_BUFFER,e.__webglVertexBuffer),z.bufferData(z.ARRAY_BUFFER,e.positionArray,z.DYNAMIC_DRAW),z.enableVertexAttribArray(t.attributes.position),z.vertexAttribPointer(t.attributes.position,3,z.FLOAT,!1,0,0)),e.hasNormal){if(z.bindBuffer(z.ARRAY_BUFFER,e.__webglNormalBuffer),i==THREE.FlatShading){var r,n,o,a,s,h,l,f=3*e.count;for(l=0;l<f;l+=9)r=(i=e.normalArray)[l],n=i[l+1],o=i[l+2],a=i[l+3],s=i[l+4],h=i[l+5],r=(r+a+i[l+6])/3,n=(n+s+i[l+7])/3,o=(o+h+i[l+8])/3,i[l]=r,i[l+1]=n,i[l+2]=o,i[l+3]=r,i[l+4]=n,i[l+5]=o,i[l+6]=r,i[l+7]=n,i[l+8]=o}z.bufferData(z.ARRAY_BUFFER,e.normalArray,z.DYNAMIC_DRAW),z.enableVertexAttribArray(t.attributes.normal),z.vertexAttribPointer(t.attributes.normal,3,z.FLOAT,!1,0,0)}z.drawArrays(z.TRIANGLES,0,e.count),e.count=0}function o(e){N!=e.doubleSided&&(e.doubleSided?z.disable(z.CULL_FACE):z.enable(z.CULL_FACE),N=e.doubleSided),W!=e.flipSided&&(e.flipSided?z.frontFace(z.CW):z.frontFace(z.CCW),W=e.flipSided)}function s(e){G!=e&&(e?z.enable(z.DEPTH_TEST):z.disable(z.DEPTH_TEST),G=e)}function h(e){X!=e&&(z.depthMask(e),X=e)}function f(e,t,i){Y!=e&&(e?z.enable(z.POLYGON_OFFSET_FILL):z.disable(z.POLYGON_OFFSET_FILL),Y=e),!e||q==t&&Z==i||(z.polygonOffset(t,i),q=t,Z=i)}function c(e){ee[0].set(e.n41-e.n11,e.n42-e.n12,e.n43-e.n13,e.n44-e.n14),ee[1].set(e.n41+e.n11,e.n42+e.n12,e.n43+e.n13,e.n44+e.n14),ee[2].set(e.n41+e.n21,e.n42+e.n22,e.n43+e.n23,e.n44+e.n24),ee[3].set(e.n41-e.n21,e.n42-e.n22,e.n43-e.n23,e.n44-e.n24),ee[4].set(e.n41-e.n31,e.n42-e.n32,e.n43-e.n33,e.n44-e.n34),ee[5].set(e.n41+e.n31,e.n42+e.n32,e.n43+e.n33,e.n44+e.n34);var t;for(e=0;e<6;e++)(t=ee[e]).divideScalar(Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z))}function u(e){for(var t=e.matrixWorld,i=-e.geometry.boundingSphere.radius*Math.max(e.scale.x,Math.max(e.scale.y,e.scale.z)),r=0;r<6;r++)if((e=ee[r].x*t.n14+ee[r].y*t.n24+ee[r].z*t.n34+ee[r].w)<=i)return!1;return!0}function E(e,t){e.list[e.count]=t,e.count+=1}function d(e){var t,i,r=e.object,n=e.opaque,o=e.transparent;for(o.count=0,e=n.count=0,t=r.materials.length;e<t;e++)(i=r.materials[e]).transparent?E(o,i):E(n,i)}function p(e){
var t,i,r,n,o=e.object,a=e.buffer,s=e.opaque,h=e.transparent;for(h.count=0,e=s.count=0,r=o.materials.length;e<r;e++)if((t=o.materials[e])instanceof THREE.MeshFaceMaterial)for(t=0,i=a.materials.length;t<i;t++)(n=a.materials[t])&&(n.transparent?E(h,n):E(s,n));else(n=t)&&(n.transparent?E(h,n):E(s,n))}function m(e,t){return t.z-e.z}function T(e){var t,a,h,l,f,E,d,p=0,m=e.lights;for(Ee||(Ee=new THREE.PerspectiveCamera(U.shadowCameraFov,U.shadowMapWidth/U.shadowMapHeight,U.shadowCameraNear,U.shadowCameraFar)),t=0,a=m.length;t<a;t++)if((h=m[t])instanceof THREE.SpotLight&&h.castShadow){for(k=-1,U.shadowMap[p]||(U.shadowMap[p]=new THREE.WebGLRenderTarget(U.shadowMapWidth,U.shadowMapHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat})),de[p]||(de[p]=new THREE.Matrix4),l=U.shadowMap[p],f=de[p],Ee.position.copy(h.position),Ee.lookAt(h.target.position),Ee.update(void 0,!0),e.update(void 0,!1,Ee),f.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),f.multiplySelf(Ee.projectionMatrix),f.multiplySelf(Ee.matrixWorldInverse),Ee.matrixWorldInverse.flattenToArray(re),Ee.projectionMatrix.flattenToArray(ie),te.multiply(Ee.projectionMatrix,Ee.matrixWorldInverse),c(te),U.initWebGLObjects(e),A(l),z.clearColor(1,1,1,1),U.clear(),z.clearColor(fe.r,fe.g,fe.b,ce),f=e.__webglObjects.length,h=e.__webglObjectsImmediate.length,l=0;l<f;l++)(d=(E=e.__webglObjects[l]).object).visible&&d.castShadow?d instanceof THREE.Mesh&&d.frustumCulled&&!u(d)?E.render=!1:(d.matrixWorld.flattenToArray(d._objectMatrixArray),R(d,Ee,!1),E.render=!0):E.render=!1;for(s(!0),w(THREE.NormalBlending),l=0;l<f;l++)(E=e.__webglObjects[l]).render&&(d=E.object,buffer=E.buffer,o(d),E=d.customDepthMaterial?d.customDepthMaterial:d.geometry.morphTargets.length?ge:me,r(Ee,m,null,E,buffer,d));for(l=0;l<h;l++)(d=(E=e.__webglObjectsImmediate[l]).object).visible&&d.castShadow&&(d.matrixAutoUpdate&&d.matrixWorld.flattenToArray(d._objectMatrixArray),O=-1,R(d,Ee,!1),o(d),program=i(Ee,m,null,me,d),d.immediateRenderCallback?d.immediateRenderCallback(program,z,ee):d.render((function(e){n(e,program,me.shading)})));p++}}function _(e,t){var i,r,n;i=_e.attributes;var o,a=_e.uniforms,s=$/J,h=[],l=.5*J,f=.5*$,c=!0;for(z.useProgram(_e.program),V=_e.program,O=G=j=-1,Re||(z.enableVertexAttribArray(_e.attributes.position),z.enableVertexAttribArray(_e.attributes.uv),Re=!0),z.disable(z.CULL_FACE),z.enable(z.BLEND),z.depthMask(!0),z.bindBuffer(z.ARRAY_BUFFER,_e.vertexBuffer),z.vertexAttribPointer(i.position,2,z.FLOAT,!1,16,0),z.vertexAttribPointer(i.uv,2,z.FLOAT,!1,16,8),z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,_e.elementBuffer),z.uniformMatrix4fv(a.projectionMatrix,!1,ie),z.activeTexture(z.TEXTURE0),z.uniform1i(a.map,0),i=0,r=e.__webglSprites.length;i<r;i++)(n=e.__webglSprites[i]).visible&&0!=n.opacity&&(n.useScreenCoordinates?n.z=-n.position.z:(n._modelViewMatrix.multiplyToArray(t.matrixWorldInverse,n.matrixWorld,n._modelViewMatrixArray),n.z=-n._modelViewMatrix.n34));for(e.__webglSprites.sort(m),i=0,r=e.__webglSprites.length;i<r;i++)(n=e.__webglSprites[i]).visible&&0!=n.opacity&&n.map&&n.map.image&&n.map.image.width&&(n.useScreenCoordinates?(z.uniform1i(a.useScreenCoordinates,1),z.uniform3f(a.screenPosition,(n.position.x-l)/l,(f-n.position.y)/f,Math.max(0,Math.min(1,n.position.z)))):(z.uniform1i(a.useScreenCoordinates,0),z.uniform1i(a.affectedByDistance,n.affectedByDistance?1:0),z.uniformMatrix4fv(a.modelViewMatrix,!1,n._modelViewMatrixArray)),o=n.map.image.width/(n.scaleByViewport?$:1),h[0]=o*s*n.scale.x,h[1]=o*n.scale.y,z.uniform2f(a.uvScale,n.uvScale.x,n.uvScale.y),z.uniform2f(a.uvOffset,n.uvOffset.x,n.uvOffset.y),z.uniform2f(a.alignment,n.alignment.x,n.alignment.y),z.uniform1f(a.opacity,n.opacity),z.uniform3f(a.color,n.color.r,n.color.g,n.color.b),z.uniform1f(a.rotation,n.rotation),z.uniform2fv(a.scale,h),n.mergeWith3D&&!c?(z.enable(z.DEPTH_TEST),c=!0):!n.mergeWith3D&&c&&(z.disable(z.DEPTH_TEST),c=!1),w(n.blending),S(n.map,0),z.drawElements(z.TRIANGLES,6,z.UNSIGNED_SHORT,0));z.enable(z.CULL_FACE),z.enable(z.DEPTH_TEST),z.depthMask(X)}function R(e,t,i){e._modelViewMatrix.multiplyToArray(t.matrixWorldInverse,e.matrixWorld,e._modelViewMatrixArray),i&&THREE.Matrix4.makeInvert3x3(e._modelViewMatrix).transposeIntoArray(e._normalMatrixArray)}function v(e){var t,i,r,n;for(n=e.__materials,e=0,i=n.length;e<i;e++)if((r=n[e]).attributes)for(t in r.attributes)if(r.attributes[t].needsUpdate)return!0;return!1}function y(e){var t,i,r,n;for(n=e.__materials,e=0,i=n.length;e<i;e++)if((r=n[e]).attributes)for(t in r.attributes)r.attributes[t].needsUpdate=!1}function x(e,t){var i;for(i=e.length-1;i>=0;i--)e[i].object==t&&e.splice(i,1)}function b(e){function t(e){var t=[];for(i=0,r=e.length;i<r;i++)null==e[i]?t.push("undefined"):t.push(e[i].id);return t.join("_")}var i,r,n,o,a,s,h,l,f={},c=void 0!==e.morphTargets?e.morphTargets.length:0;for(e.geometryGroups={},n=0,o=e.faces.length;n<o;n++)null==f[h=t(s=(a=e.faces[n]).materials)]&&(f[h]={hash:h,counter:0}),l=f[h].hash+"_"+f[h].counter,null==e.geometryGroups[l]&&(e.geometryGroups[l]={faces:[],materials:s,vertices:0,numMorphTargets:c}),a=a instanceof THREE.Face3?3:4,e.geometryGroups[l].vertices+a>65535&&(f[h].counter+=1,l=f[h].hash+"_"+f[h].counter,null==e.geometryGroups[l]&&(e.geometryGroups[l]={faces:[],materials:s,vertices:0,numMorphTargets:c})),e.geometryGroups[l].faces.push(n),e.geometryGroups[l].vertices+=a;for(var u in e.geometryGroupsList=[],e.geometryGroups)e.geometryGroups[u].id=I++,e.geometryGroupsList.push(e.geometryGroups[u])}function H(e,t,i){e.push({buffer:t,object:i,opaque:{list:[],count:0},transparent:{list:[],count:0}})}function w(e){if(e!=j){switch(e){case THREE.AdditiveBlending:z.blendEquation(z.FUNC_ADD),z.blendFunc(z.SRC_ALPHA,z.ONE);break;case THREE.SubtractiveBlending:z.blendEquation(z.FUNC_ADD),z.blendFunc(z.ZERO,z.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:z.blendEquation(z.FUNC_ADD),z.blendFunc(z.ZERO,z.SRC_COLOR);break;default:z.blendEquationSeparate(z.FUNC_ADD,z.FUNC_ADD),z.blendFuncSeparate(z.SRC_ALPHA,z.ONE_MINUS_SRC_ALPHA,z.ONE,z.ONE_MINUS_SRC_ALPHA)}j=e}}function M(e,t,i){i.width&i.width-1||i.height&i.height-1?(z.texParameteri(e,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(e,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),z.texParameteri(e,z.TEXTURE_MAG_FILTER,L(t.magFilter)),z.texParameteri(e,z.TEXTURE_MIN_FILTER,L(t.minFilter))):(z.texParameteri(e,z.TEXTURE_WRAP_S,B(t.wrapS)),z.texParameteri(e,z.TEXTURE_WRAP_T,B(t.wrapT)),z.texParameteri(e,z.TEXTURE_MAG_FILTER,B(t.magFilter)),z.texParameteri(e,z.TEXTURE_MIN_FILTER,B(t.minFilter)),z.generateMipmap(e))}function S(e,t){e.needsUpdate?(e.__webglInit||(e.__webglInit=!0,e.__webglTexture=z.createTexture(),U.info.memory.textures++),z.activeTexture(z.TEXTURE0+t),z.bindTexture(z.TEXTURE_2D,e.__webglTexture),e instanceof THREE.DataTexture?z.texImage2D(z.TEXTURE_2D,0,B(e.format),e.image.width,e.image.height,0,B(e.format),z.UNSIGNED_BYTE,e.image.data):z.texImage2D(z.TEXTURE_2D,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,e.image),M(z.TEXTURE_2D,e,e.image),e.needsUpdate=!1):(z.activeTexture(z.TEXTURE0+t),z.bindTexture(z.TEXTURE_2D,e.__webglTexture))}function A(e){var t,i,r=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){if(void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.__webglRenderbuffer=z.createRenderbuffer(),e.__webglTexture=z.createTexture(),r){z.bindTexture(z.TEXTURE_CUBE_MAP,e.__webglTexture),M(z.TEXTURE_CUBE_MAP,e,e),e.__webglFramebuffer=[];for(var n=0;n<6;n++)e.__webglFramebuffer[n]=z.createFramebuffer(),z.texImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,B(e.format),e.width,e.height,0,B(e.format),B(e.type),null)}else e.__webglFramebuffer=z.createFramebuffer(),z.bindTexture(z.TEXTURE_2D,e.__webglTexture),M(z.TEXTURE_2D,e,e),z.texImage2D(z.TEXTURE_2D,0,B(e.format),e.width,e.height,0,B(e.format),B(e.type),null);if(z.bindRenderbuffer(z.RENDERBUFFER,e.__webglRenderbuffer),r)for(n=0;n<6;++n)z.bindFramebuffer(z.FRAMEBUFFER,e.__webglFramebuffer[n]),z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_CUBE_MAP_POSITIVE_X+n,e.__webglTexture,0);else z.bindFramebuffer(z.FRAMEBUFFER,e.__webglFramebuffer),z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_2D,e.__webglTexture,0);e.depthBuffer&&!e.stencilBuffer?(z.renderbufferStorage(z.RENDERBUFFER,z.DEPTH_COMPONENT16,e.width,e.height),z.framebufferRenderbuffer(z.FRAMEBUFFER,z.DEPTH_ATTACHMENT,z.RENDERBUFFER,e.__webglRenderbuffer)):e.depthBuffer&&e.stencilBuffer?(z.renderbufferStorage(z.RENDERBUFFER,z.DEPTH_STENCIL,e.width,e.height),z.framebufferRenderbuffer(z.FRAMEBUFFER,z.DEPTH_STENCIL_ATTACHMENT,z.RENDERBUFFER,e.__webglRenderbuffer)):z.renderbufferStorage(z.RENDERBUFFER,z.RGBA4,e.width,e.height),r?z.bindTexture(z.TEXTURE_CUBE_MAP,null):z.bindTexture(z.TEXTURE_2D,null),z.bindRenderbuffer(z.RENDERBUFFER,null),z.bindFramebuffer(z.FRAMEBUFFER,null)}e?(r=r?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,n=e.width,e=e.height,i=t=0):(r=null,n=J,e=$,t=Q,i=K),r!=P&&(z.bindFramebuffer(z.FRAMEBUFFER,r),z.viewport(t,i,n,e),P=r)}function C(e){e instanceof THREE.WebGLRenderTargetCube?(z.bindTexture(z.TEXTURE_CUBE_MAP,e.__webglTexture),z.generateMipmap(z.TEXTURE_CUBE_MAP),z.bindTexture(z.TEXTURE_CUBE_MAP,null)):(z.bindTexture(z.TEXTURE_2D,e.__webglTexture),z.generateMipmap(z.TEXTURE_2D),z.bindTexture(z.TEXTURE_2D,null))}function F(e,t){var i;return"fragment"==e?i=z.createShader(z.FRAGMENT_SHADER):"vertex"==e&&(i=z.createShader(z.VERTEX_SHADER)),z.shaderSource(i,t),z.compileShader(i),z.getShaderParameter(i,z.COMPILE_STATUS)?i:null}function L(e){switch(e){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return z.NEAREST;default:return z.LINEAR}}function B(e){switch(e){case THREE.RepeatWrapping:return z.REPEAT;case THREE.ClampToEdgeWrapping:return z.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return z.MIRRORED_REPEAT;case THREE.NearestFilter:return z.NEAREST;case THREE.NearestMipMapNearestFilter:return z.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return z.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return z.LINEAR;case THREE.LinearMipMapNearestFilter:return z.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return z.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return z.BYTE;case THREE.UnsignedByteType:return z.UNSIGNED_BYTE;case THREE.ShortType:return z.SHORT;case THREE.UnsignedShortType:return z.UNSIGNED_SHORT;case THREE.IntType:return z.INT;case THREE.UnsignedShortType:return z.UNSIGNED_INT;case THREE.FloatType:return z.FLOAT;case THREE.AlphaFormat:return z.ALPHA;case THREE.RGBFormat:return z.RGB;case THREE.RGBAFormat:return z.RGBA;case THREE.LuminanceFormat:return z.LUMINANCE;case THREE.LuminanceAlphaFormat:return z.LUMINANCE_ALPHA}return 0}var z,U=this,D=[],V=null,P=null,k=-1,O=null,I=0,N=null,W=null,j=null,G=null,X=null,Y=null,q=null,Z=null,Q=0,K=0,J=0,$=0,ee=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],te=new THREE.Matrix4,ie=new Float32Array(16),re=new Float32Array(16),ne=new THREE.Vector4,oe={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}},ae=void 0!==(e=e||{}).canvas?e.canvas:document.createElement("canvas"),se=void 0===e.stencil||e.stencil,he=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,le=void 0!==e.antialias&&e.antialias,fe=void 0!==e.clearColor?new THREE.Color(e.clearColor):new THREE.Color(0),ce=void 0!==e.clearAlpha?e.clearAlpha:0,ue=void 0!==e.maxLights?e.maxLights:4;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0}},this.maxMorphTargets=8,this.domElement=ae,this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapBias=.0039,this.shadowMapDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCameraNear=1,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowMap=[],this.shadowMapEnabled=!1,this.shadowMapSoft=!0;var Ee,de=[],pe=(e=THREE.ShaderLib.depthRGBA,THREE.UniformsUtils.clone(e.uniforms)),me=new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:pe}),ge=new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:pe,morphTargets:!0});me._shadowPass=!0,ge._shadowPass=!0;try{if(!(z=ae.getContext("experimental-webgl",{antialias:le,stencil:se,preserveDrawingBuffer:he})))throw"Error creating WebGL context."}catch(e){}z.clearColor(0,0,0,1),z.clearDepth(1),z.clearStencil(0),z.enable(z.DEPTH_TEST),z.depthFunc(z.LEQUAL),z.frontFace(z.CCW),z.cullFace(z.BACK),z.enable(z.CULL_FACE),z.enable(z.BLEND),z.blendEquation(z.FUNC_ADD),z.blendFunc(z.SRC_ALPHA,z.ONE_MINUS_SRC_ALPHA),z.clearColor(fe.r,fe.g,fe.b,ce),this.context=z;var Te=z.getParameter(z.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0,_e={};_e.vertices=new Float32Array(16),_e.faces=new Uint16Array(6),se=0,_e.vertices[se++]=-1,_e.vertices[se++]=-1,_e.vertices[se++]=0,_e.vertices[se++]=1,_e.vertices[se++]=1,_e.vertices[se++]=-1,_e.vertices[se++]=1,_e.vertices[se++]=1,_e.vertices[se++]=1,_e.vertices[se++]=1,_e.vertices[se++]=1,_e.vertices[se++]=0,_e.vertices[se++]=-1,_e.vertices[se++]=1,_e.vertices[se++]=0,se=_e.vertices[se++]=0,_e.faces[se++]=0,_e.faces[se++]=1,_e.faces[se++]=2,_e.faces[se++]=0,_e.faces[se++]=2,_e.faces[se++]=3,_e.vertexBuffer=z.createBuffer(),_e.elementBuffer=z.createBuffer(),z.bindBuffer(z.ARRAY_BUFFER,_e.vertexBuffer),z.bufferData(z.ARRAY_BUFFER,_e.vertices,z.STATIC_DRAW),z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,_e.elementBuffer),z.bufferData(z.ELEMENT_ARRAY_BUFFER,_e.faces,z.STATIC_DRAW),_e.program=z.createProgram(),z.attachShader(_e.program,F("fragment",THREE.ShaderLib.sprite.fragmentShader)),z.attachShader(_e.program,F("vertex",THREE.ShaderLib.sprite.vertexShader)),z.linkProgram(_e.program),_e.attributes={},_e.uniforms={},_e.attributes.position=z.getAttribLocation(_e.program,"position"),_e.attributes.uv=z.getAttribLocation(_e.program,"uv"),_e.uniforms.uvOffset=z.getUniformLocation(_e.program,"uvOffset"),_e.uniforms.uvScale=z.getUniformLocation(_e.program,"uvScale"),_e.uniforms.rotation=z.getUniformLocation(_e.program,"rotation"),_e.uniforms.scale=z.getUniformLocation(_e.program,"scale"),_e.uniforms.alignment=z.getUniformLocation(_e.program,"alignment"),_e.uniforms.color=z.getUniformLocation(_e.program,"color"),_e.uniforms.map=z.getUniformLocation(_e.program,"map"),_e.uniforms.opacity=z.getUniformLocation(_e.program,"opacity"),_e.uniforms.useScreenCoordinates=z.getUniformLocation(_e.program,"useScreenCoordinates"),_e.uniforms.affectedByDistance=z.getUniformLocation(_e.program,"affectedByDistance"),_e.uniforms.screenPosition=z.getUniformLocation(_e.program,"screenPosition"),_e.uniforms.modelViewMatrix=z.getUniformLocation(_e.program,"modelViewMatrix"),_e.uniforms.projectionMatrix=z.getUniformLocation(_e.program,"projectionMatrix");var Re=!1;this.setSize=function(e,t){ae.width=e,ae.height=t,this.setViewport(0,0,ae.width,ae.height)},this.setViewport=function(e,t,i,r){Q=e,K=t,J=i,$=r,z.viewport(Q,K,J,$)},this.setScissor=function(e,t,i,r){z.scissor(e,t,i,r)},this.enableScissorTest=function(e){e?z.enable(z.SCISSOR_TEST):z.disable(z.SCISSOR_TEST)},this.setClearColorHex=function(e,t){fe.setHex(e),ce=t,z.clearColor(fe.r,fe.g,fe.b,ce)},this.setClearColor=function(e,t){fe.copy(e),ce=t,z.clearColor(fe.r,fe.g,fe.b,ce)},this.getClearColor=function(){return fe},this.getClearAlpha=function(){return ce},this.clear=function(e,t,i){var r=0;(null==e||e)&&(r|=z.COLOR_BUFFER_BIT),(null==t||t)&&(r|=z.DEPTH_BUFFER_BIT),(null==i||i)&&(r|=z.STENCIL_BUFFER_BIT),z.clear(r)},this.getContext=function(){return z},this.deallocateObject=function(e){if(e.__webglInit)if(e.__webglInit=!1,delete e._modelViewMatrix,delete e._normalMatrixArray,delete e._modelViewMatrixArray,delete e._objectMatrixArray,e instanceof THREE.Mesh)for(g in e.geometry.geometryGroups){var t=e.geometry.geometryGroups[g];if(z.deleteBuffer(t.__webglVertexBuffer),z.deleteBuffer(t.__webglNormalBuffer),z.deleteBuffer(t.__webglTangentBuffer),z.deleteBuffer(t.__webglColorBuffer),z.deleteBuffer(t.__webglUVBuffer),z.deleteBuffer(t.__webglUV2Buffer),z.deleteBuffer(t.__webglSkinVertexABuffer),z.deleteBuffer(t.__webglSkinVertexBBuffer),z.deleteBuffer(t.__webglSkinIndicesBuffer),z.deleteBuffer(t.__webglSkinWeightsBuffer),z.deleteBuffer(t.__webglFaceBuffer),z.deleteBuffer(t.__webglLineBuffer),t.numMorphTargets)for(var i=0,r=t.numMorphTargets;i<r;i++)z.deleteBuffer(t.__webglMorphTargetsBuffers[i]);U.info.memory.geometries--}else(e instanceof THREE.Ribbon||e instanceof THREE.Line||e instanceof THREE.ParticleSystem)&&(e=e.geometry,z.deleteBuffer(e.__webglVertexBuffer),z.deleteBuffer(e.__webglColorBuffer),U.info.memory.geometries--)},this.deallocateTexture=function(e){e.__webglInit&&(e.__webglInit=!1,z.deleteTexture(e.__webglTexture),U.info.memory.textures--)},this.initMaterial=function(e,t,i,r){var n,o,a,s,h,l,f;if(e instanceof THREE.MeshDepthMaterial?s="depth":e instanceof THREE.MeshNormalMaterial?s="normal":e instanceof THREE.MeshBasicMaterial?s="basic":e instanceof THREE.MeshLambertMaterial?s="lambert":e instanceof THREE.MeshPhongMaterial?s="phong":e instanceof THREE.LineBasicMaterial?s="basic":e instanceof THREE.ParticleBasicMaterial&&(s="particle_basic"),s){var c=THREE.ShaderLib[s];e.uniforms=THREE.UniformsUtils.clone(c.uniforms),e.vertexShader=c.vertexShader,e.fragmentShader=c.fragmentShader}for(h=f=c=0,l=t.length;h<l;h++)(a=t[h])instanceof THREE.SpotLight&&f++,a instanceof THREE.DirectionalLight&&f++,a instanceof THREE.PointLight&&c++;for(c+f<=ue?h=f:(h=Math.ceil(ue*f/(c+f)),c=ue-h),a={directional:h,point:c},c=f=0,h=t.length;c<h;c++)(l=t[c])instanceof THREE.SpotLight&&l.castShadow&&f++;var u,E=50;void 0!==r&&r instanceof THREE.SkinnedMesh&&(E=r.bones.length);e:{h=e.fragmentShader,l=e.vertexShader;var d;c=e.uniforms,t=e.attributes,i={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,vertexColors:e.vertexColors,fog:i,useFog:e.fog,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,morphTargets:e.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:a.directional,maxPointLights:a.point,maxBones:E,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapWidth:this.shadowMapWidth,shadowMapHeight:this.shadowMapHeight,maxShadows:f,alphaTest:e.alphaTest},r=[];for(d in s?r.push(s):(r.push(h),r.push(l)),i)r.push(d),r.push(i[d]);for(s=r.join(),d=0,r=D.length;d<r;d++)if(D[d].code==s){u=D[d].program;break e}d=z.createProgram(),r=[Te?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.vertexColors?"#define USE_COLOR":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapSoft?"#define SHADOWMAP_SOFT":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),a=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SHADOWS "+i.maxShadows,i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.vertexColors?"#define USE_COLOR":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapSoft?"#define SHADOWMAP_SOFT":"",i.shadowMapSoft?"#define SHADOWMAP_WIDTH "+i.shadowMapWidth.toFixed(1):"",i.shadowMapSoft?"#define SHADOWMAP_HEIGHT "+i.shadowMapHeight.toFixed(1):"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),z.attachShader(d,F("fragment",a+h)),z.attachShader(d,F("vertex",r+l)),z.linkProgram(d),z.getProgramParameter(d,z.LINK_STATUS),d.uniforms={},d.attributes={};var p;r=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(p in c)r.push(p);for(p=r,r=0,c=p.length;r<c;r++)h=p[r],d.uniforms[h]=z.getUniformLocation(d,h);for(r=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"],p=0;p<i.maxMorphTargets;p++)r.push("morphTarget"+p);for(u in t)r.push(u);for(p=0,t=(u=r).length;p<t;p++)i=u[p],d.attributes[i]=z.getAttribLocation(d,i);d.id=D.length,D.push({program:d,code:s}),U.info.memory.programs=D.length,u=d}if(e.program=u,(u=e.program.attributes).position>=0&&z.enableVertexAttribArray(u.position),u.color>=0&&z.enableVertexAttribArray(u.color),u.normal>=0&&z.enableVertexAttribArray(u.normal),u.tangent>=0&&z.enableVertexAttribArray(u.tangent),e.skinning&&u.skinVertexA>=0&&u.skinVertexB>=0&&u.skinIndex>=0&&u.skinWeight>=0&&(z.enableVertexAttribArray(u.skinVertexA),z.enableVertexAttribArray(u.skinVertexB),z.enableVertexAttribArray(u.skinIndex),z.enableVertexAttribArray(u.skinWeight)),e.attributes)for(o in e.attributes)void 0!==u[o]&&u[o]>=0&&z.enableVertexAttribArray(u[o]);if(e.morphTargets)for(o=e.numSupportedMorphTargets=0;o<this.maxMorphTargets;o++)u[p="morphTarget"+o]>=0&&(z.enableVertexAttribArray(u[p]),e.numSupportedMorphTargets++);for(n in e.uniformsList=[],e.uniforms)e.uniformsList.push([e.uniforms[n],n])},this.clearTarget=function(e,t,i,r){A(e),this.clear(t,i,r)},this.render=function(e,t,a,l){var E,g,v,y,x,b,H,M,S=e.lights,F=e.fog;for(k=-1,this.shadowMapEnabled&&T(e,t),U.info.render.calls=0,U.info.render.vertices=0,U.info.render.faces=0,t.matrixAutoUpdate&&t.update(void 0,!0),e.update(void 0,!1,t),t.matrixWorldInverse.flattenToArray(re),t.projectionMatrix.flattenToArray(ie),te.multiply(t.projectionMatrix,t.matrixWorldInverse),c(te),this.initWebGLObjects(e),A(a),(this.autoClear||l)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),x=e.__webglObjects.length,l=0;l<x;l++)(H=(E=e.__webglObjects[l]).object).visible?H instanceof THREE.Mesh&&H.frustumCulled&&!u(H)?E.render=!1:(H.matrixWorld.flattenToArray(H._objectMatrixArray),R(H,t,!0),p(E),E.render=!0,this.sortObjects&&(E.object.renderDepth?E.z=E.object.renderDepth:(ne.copy(H.position),te.multiplyVector3(ne),E.z=ne.z))):E.render=!1;for(this.sortObjects&&e.__webglObjects.sort(m),b=e.__webglObjectsImmediate.length,l=0;l<b;l++)(H=(E=e.__webglObjectsImmediate[l]).object).visible&&(H.matrixAutoUpdate&&H.matrixWorld.flattenToArray(H._objectMatrixArray),R(H,t,!0),d(E));if(e.overrideMaterial){for(s(e.overrideMaterial.depthTest),w(e.overrideMaterial.blending),l=0;l<x;l++)(E=e.__webglObjects[l]).render&&(H=E.object,M=E.buffer,o(H),r(t,S,F,e.overrideMaterial,M,H));for(l=0;l<b;l++)(H=(E=e.__webglObjectsImmediate[l]).object).visible&&(O=-1,o(H),g=i(t,S,F,e.overrideMaterial,H),H.immediateRenderCallback?H.immediateRenderCallback(g,z,ee):H.render((function(t){n(t,g,e.overrideMaterial.shading)})))}else{for(w(THREE.NormalBlending),l=x-1;l>=0;l--)if((E=e.__webglObjects[l]).render)for(H=E.object,M=E.buffer,v=E.opaque,o(H),E=0;E<v.count;E++)s((y=v.list[E]).depthTest),h(y.depthWrite),f(y.polygonOffset,y.polygonOffsetFactor,y.polygonOffsetUnits),r(t,S,F,y,M,H);for(l=0;l<b;l++)if((H=(E=e.__webglObjectsImmediate[l]).object).visible)for(O=-1,v=E.opaque,o(H),E=0;E<v.count;E++)s((y=v.list[E]).depthTest),h(y.depthWrite),f(y.polygonOffset,y.polygonOffsetFactor,y.polygonOffsetUnits),g=i(t,S,F,y,H),H.immediateRenderCallback?H.immediateRenderCallback(g,z,ee):H.render((function(e){n(e,g,y.shading)}));for(l=0;l<x;l++)if((E=e.__webglObjects[l]).render)for(H=E.object,M=E.buffer,v=E.transparent,o(H),E=0;E<v.count;E++)w((y=v.list[E]).blending),s(y.depthTest),h(y.depthWrite),f(y.polygonOffset,y.polygonOffsetFactor,y.polygonOffsetUnits),r(t,S,F,y,M,H);for(l=0;l<b;l++)if((H=(E=e.__webglObjectsImmediate[l]).object).visible)for(O=-1,v=E.transparent,o(H),E=0;E<v.count;E++)w((y=v.list[E]).blending),s(y.depthTest),h(y.depthWrite),f(y.polygonOffset,y.polygonOffsetFactor,y.polygonOffsetUnits),g=i(t,S,F,y,H),H.immediateRenderCallback?H.immediateRenderCallback(g,z,ee):H.render((function(e){n(e,g,y.shading)}))}e.__webglSprites.length&&_(e,t),a&&a.minFilter!==THREE.NearestFilter&&a.minFilter!==THREE.LinearFilter&&C(a)},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[]);e.__objectsAdded.length;){var i=e.__objectsAdded[0],r=e,n=void 0,o=void 0,s=void 0;if(!i.__webglInit)if(i.__webglInit=!0,i._modelViewMatrix=new THREE.Matrix4,i._normalMatrixArray=new Float32Array(9),i._modelViewMatrixArray=new Float32Array(16),i._objectMatrixArray=new Float32Array(16),i.matrixWorld.flattenToArray(i._objectMatrixArray),i instanceof THREE.Mesh){for(n in null==(o=i.geometry).geometryGroups&&b(o),o.geometryGroups)if(!(s=o.geometryGroups[n]).__webglVertexBuffer){if((c=s).__webglVertexBuffer=z.createBuffer(),c.__webglNormalBuffer=z.createBuffer(),c.__webglTangentBuffer=z.createBuffer(),c.__webglColorBuffer=z.createBuffer(),c.__webglUVBuffer=z.createBuffer(),c.__webglUV2Buffer=z.createBuffer(),c.__webglSkinVertexABuffer=z.createBuffer(),c.__webglSkinVertexBBuffer=z.createBuffer(),c.__webglSkinIndicesBuffer=z.createBuffer(),c.__webglSkinWeightsBuffer=z.createBuffer(),c.__webglFaceBuffer=z.createBuffer(),c.__webglLineBuffer=z.createBuffer(),c.numMorphTargets){var h=void 0,f=void 0;for(c.__webglMorphTargetsBuffers=[],h=0,f=c.numMorphTargets;h<f;h++)c.__webglMorphTargetsBuffers.push(z.createBuffer())}U.info.memory.geometries++;var c,u=void 0,E=void 0,d=void 0,p=d=void 0,m=void 0,g=void 0,T=g=h=0,_=d=E=void 0;for(d=f=_=E=u=void 0,m=(p=(c=i).geometry).faces,u=0,E=(_=s.faces).length;u<E;u++)(d=m[d=_[u]])instanceof THREE.Face3?(h+=3,g+=1,T+=3):d instanceof THREE.Face4&&(h+=4,g+=2,T+=4);u=s;var R=_=m=void 0,w=void 0;for(R=void 0,d=[],m=0,_=(E=c).materials.length;m<_;m++)if((R=E.materials[m])instanceof THREE.MeshFaceMaterial)for(R=0,l=u.materials.length;R<l;R++)(w=u.materials[R])&&d.push(w);else(w=R)&&d.push(w);u=d,s.__materials=u;e:{for(m=E=void 0,_=u.length,E=0;E<_;E++)if((m=u[E]).map||m.lightMap||m instanceof THREE.ShaderMaterial){E=!0;break e}E=!1}e:{for(_=m=void 0,d=u.length,m=0;m<d;m++)if(!((_=u[m])instanceof THREE.MeshBasicMaterial&&!_.envMap||_ instanceof THREE.MeshDepthMaterial)){_=_&&null!=_.shading&&_.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;break e}_=!1}e:{for(d=m=void 0,R=u.length,m=0;m<R;m++)if((d=u[m]).vertexColors){d=d.vertexColors;break e}d=!1}if(s.__vertexArray=new Float32Array(3*h),_&&(s.__normalArray=new Float32Array(3*h)),p.hasTangents&&(s.__tangentArray=new Float32Array(4*h)),d&&(s.__colorArray=new Float32Array(3*h)),E&&((p.faceUvs.length>0||p.faceVertexUvs.length>0)&&(s.__uvArray=new Float32Array(2*h)),(p.faceUvs.length>1||p.faceVertexUvs.length>1)&&(s.__uv2Array=new Float32Array(2*h))),c.geometry.skinWeights.length&&c.geometry.skinIndices.length&&(s.__skinVertexAArray=new Float32Array(4*h),s.__skinVertexBArray=new Float32Array(4*h),s.__skinIndexArray=new Float32Array(4*h),s.__skinWeightArray=new Float32Array(4*h)),s.__faceArray=new Uint16Array(3*g+(c.geometry.edgeFaces?6*c.geometry.edgeFaces.length:0)),s.__lineArray=new Uint16Array(2*T),s.numMorphTargets)for(s.__morphTargetsArrays=[],p=0,m=s.numMorphTargets;p<m;p++)s.__morphTargetsArrays.push(new Float32Array(3*h));for(s.__needsSmoothNormals=_==THREE.SmoothShading,s.__uvType=E,s.__vertexColorType=d,s.__normalType=_,s.__webglFaceCount=3*g+(c.geometry.edgeFaces?6*c.geometry.edgeFaces.length:0),s.__webglLineCount=2*T,p=0,m=u.length;p<m;p++)if((E=u[p]).attributes)for(a in void 0===s.__webglCustomAttributes&&(s.__webglCustomAttributes={}),E.attributes){for(f in _={},d=E.attributes[a])_[f]=d[f];_.__webglInitialized&&!_.createUniqueBuffers||(_.__webglInitialized=!0,g=1,"v2"===_.type?g=2:"v3"===_.type?g=3:"v4"===_.type?g=4:"c"===_.type&&(g=3),_.size=g,_.array=new Float32Array(h*g),_.buffer=z.createBuffer(),_.buffer.belongsToAttribute=a,d.needsUpdate=!0,_.__original=d),s.__webglCustomAttributes[a]=_}s.__inittedArrays=!0,o.__dirtyVertices=!0,o.__dirtyMorphTargets=!0,o.__dirtyElements=!0,o.__dirtyUvs=!0,o.__dirtyNormals=!0,o.__dirtyTangents=!0,o.__dirtyColors=!0}}else if(i instanceof THREE.Ribbon)(o=i.geometry).__webglVertexBuffer||((s=o).__webglVertexBuffer=z.createBuffer(),s.__webglColorBuffer=z.createBuffer(),U.info.memory.geometries++,c=(s=o).vertices.length,s.__vertexArray=new Float32Array(3*c),s.__colorArray=new Float32Array(3*c),s.__webglVertexCount=c,o.__dirtyVertices=!0,o.__dirtyColors=!0);else if(i instanceof THREE.Line)(o=i.geometry).__webglVertexBuffer||((s=o).__webglVertexBuffer=z.createBuffer(),s.__webglColorBuffer=z.createBuffer(),U.info.memory.geometries++,c=(s=o).vertices.length,s.__vertexArray=new Float32Array(3*c),s.__colorArray=new Float32Array(3*c),s.__webglLineCount=c,o.__dirtyVertices=!0,o.__dirtyColors=!0);else if(i instanceof THREE.ParticleSystem&&!(o=i.geometry).__webglVertexBuffer){for((s=o).__webglVertexBuffer=z.createBuffer(),s.__webglColorBuffer=z.createBuffer(),U.info.geometries++,c=i,h=(s=o).vertices.length,s.__vertexArray=new Float32Array(3*h),s.__colorArray=new Float32Array(3*h),s.__sortArray=[],s.__webglParticleCount=h,s.__materials=c.materials,T=g=f=void 0,f=0,g=c.materials.length;f<g;f++)if((T=c.materials[f]).attributes)for(a in void 0===s.__webglCustomAttributes&&(s.__webglCustomAttributes={}),T.attributes){for(property in originalAttribute=T.attributes[a],attribute={},originalAttribute)attribute[property]=originalAttribute[property];attribute.__webglInitialized&&!attribute.createUniqueBuffers||(attribute.__webglInitialized=!0,size=1,"v2"===attribute.type?size=2:"v3"===attribute.type?size=3:"v4"===attribute.type?size=4:"c"===attribute.type&&(size=3),attribute.size=size,attribute.array=new Float32Array(h*size),attribute.buffer=z.createBuffer(),attribute.buffer.belongsToAttribute=a,originalAttribute.needsUpdate=!0,attribute.__original=originalAttribute),s.__webglCustomAttributes[a]=attribute}o.__dirtyVertices=!0,o.__dirtyColors=!0}if(!i.__webglActive){if(i instanceof THREE.Mesh)for(n in(o=i.geometry).geometryGroups)s=o.geometryGroups[n],H(r.__webglObjects,s,i);else i instanceof THREE.Ribbon||i instanceof THREE.Line||i instanceof THREE.ParticleSystem?(o=i.geometry,H(r.__webglObjects,o,i)):void 0!==THREE.MarchingCubes&&i instanceof THREE.MarchingCubes||i.immediateRenderCallback?r.__webglObjectsImmediate.push({object:i,opaque:{list:[],count:0},transparent:{list:[],count:0}}):i instanceof THREE.Sprite&&r.__webglSprites.push(i);i.__webglActive=!0}e.__objectsAdded.splice(0,1)}for(;e.__objectsRemoved.length;){if(r=e,(i=e.__objectsRemoved[0])instanceof THREE.Mesh||i instanceof THREE.ParticleSystem||i instanceof THREE.Ribbon||i instanceof THREE.Line)x(r.__webglObjects,i);else if(i instanceof THREE.Sprite)for(n=i,o=void 0,o=(r=r.__webglSprites).length-1;o>=0;o--)r[o]==n&&r.splice(o,1);else(i instanceof THREE.MarchingCubes||i.immediateRenderCallback)&&x(r.__webglObjectsImmediate,i);i.__webglActive=!1,e.__objectsRemoved.splice(0,1)}for(i=0,r=e.__webglObjects.length;i<r;i++)if(f=s=n=void 0,(o=e.__webglObjects[i].object)instanceof THREE.Mesh){for(c=0,h=(n=o.geometry).geometryGroupsList.length;c<h;c++)if(f=v(s=n.geometryGroupsList[c]),(n.__dirtyVertices||n.__dirtyMorphTargets||n.__dirtyElements||n.__dirtyUvs||n.__dirtyNormals||n.__dirtyColors||n.__dirtyTangents||f)&&(f=s,g=z.DYNAMIC_DRAW,T=!n.dynamic,f.__inittedArrays)){var M=u=p=void 0,S=void 0,A=M=void 0,C=void 0,F=void 0,L=void 0,B=w=R=d=_=m=E=void 0,D=void 0,V=void 0,P=S=L=S=F=C=void 0,k=void 0,O=k=P=C=void 0,I=void 0,N=O=k=P=M=M=A=L=S=O=k=P=I=O=k=P=I=O=k=P=void 0,W=0,j=0,G=0,X=0,Y=0,q=0,Z=0,Q=0,K=0,J=0,$=0,ee=(O=P=0,O=void 0,
f.__vertexArray),te=f.__uvArray,ie=f.__uv2Array,re=f.__normalArray,ne=f.__tangentArray,oe=f.__colorArray,ae=f.__skinVertexAArray,se=f.__skinVertexBArray,he=f.__skinIndexArray,le=f.__skinWeightArray,fe=f.__morphTargetsArrays,ce=f.__webglCustomAttributes,ue=(k=void 0,f.__faceArray),Ee=f.__lineArray,de=f.__needsSmoothNormals,pe=(m=f.__vertexColorType,E=f.__uvType,_=f.__normalType,o.geometry),me=pe.__dirtyVertices,ge=pe.__dirtyElements,Te=pe.__dirtyUvs,_e=pe.__dirtyNormals,Re=pe.__dirtyTangents,ve=pe.__dirtyColors,ye=pe.__dirtyMorphTargets,xe=pe.vertices,be=f.faces,He=pe.faces,we=pe.faceVertexUvs[0],Me=pe.faceVertexUvs[1],Se=pe.skinVerticesA,Ae=pe.skinVerticesB,Ce=pe.skinIndices,Fe=pe.skinWeights,Le=pe.morphTargets;if(ce)for(N in ce)ce[N].offset=0,ce[N].offsetSrc=0;for(p=0,u=be.length;p<u;p++)if(S=He[M=be[p]],we&&(d=we[M]),Me&&(R=Me[M]),M=S.vertexNormals,A=S.normal,C=S.vertexColors,F=S.color,L=S.vertexTangents,S instanceof THREE.Face3){if(me&&(w=xe[S.a].position,B=xe[S.b].position,D=xe[S.c].position,ee[j]=w.x,ee[j+1]=w.y,ee[j+2]=w.z,ee[j+3]=B.x,ee[j+4]=B.y,ee[j+5]=B.z,ee[j+6]=D.x,ee[j+7]=D.y,ee[j+8]=D.z,j+=9),ce)for(N in ce)(k=ce[N]).__original.needsUpdate&&(P=k.offset,O=k.offsetSrc,1===k.size?(void 0===k.boundTo||"vertices"===k.boundTo?(k.array[P]=k.value[S.a],k.array[P+1]=k.value[S.b],k.array[P+2]=k.value[S.c]):"faces"===k.boundTo?(O=k.value[O],k.array[P]=O,k.array[P+1]=O,k.array[P+2]=O,k.offsetSrc++):"faceVertices"===k.boundTo&&(k.array[P]=k.value[O],k.array[P+1]=k.value[O+1],k.array[P+2]=k.value[O+2],k.offsetSrc+=3),k.offset+=3):(void 0===k.boundTo||"vertices"===k.boundTo?(w=k.value[S.a],B=k.value[S.b],D=k.value[S.c]):"faces"===k.boundTo?(D=B=w=O=k.value[O],k.offsetSrc++):"faceVertices"===k.boundTo&&(w=k.value[O],B=k.value[O+1],D=k.value[O+2],k.offsetSrc+=3),2===k.size?(k.array[P]=w.x,k.array[P+1]=w.y,k.array[P+2]=B.x,k.array[P+3]=B.y,k.array[P+4]=D.x,k.array[P+5]=D.y,k.offset+=6):3===k.size?("c"===k.type?(k.array[P]=w.r,k.array[P+1]=w.g,k.array[P+2]=w.b,k.array[P+3]=B.r,k.array[P+4]=B.g,k.array[P+5]=B.b,k.array[P+6]=D.r,k.array[P+7]=D.g,k.array[P+8]=D.b):(k.array[P]=w.x,k.array[P+1]=w.y,k.array[P+2]=w.z,k.array[P+3]=B.x,k.array[P+4]=B.y,k.array[P+5]=B.z,k.array[P+6]=D.x,k.array[P+7]=D.y,k.array[P+8]=D.z),k.offset+=9):(k.array[P]=w.x,k.array[P+1]=w.y,k.array[P+2]=w.z,k.array[P+3]=w.w,k.array[P+4]=B.x,k.array[P+5]=B.y,k.array[P+6]=B.z,k.array[P+7]=B.w,k.array[P+8]=D.x,k.array[P+9]=D.y,k.array[P+10]=D.z,k.array[P+11]=D.w,k.offset+=12)));if(ye){for(P=0,k=Le.length;P<k;P++)w=Le[P].vertices[S.a].position,B=Le[P].vertices[S.b].position,D=Le[P].vertices[S.c].position,(O=fe[P])[$]=w.x,O[$+1]=w.y,O[$+2]=w.z,O[$+3]=B.x,O[$+4]=B.y,O[$+5]=B.z,O[$+6]=D.x,O[$+7]=D.y,O[$+8]=D.z;$+=9}if(Fe.length&&(P=Fe[S.a],k=Fe[S.b],O=Fe[S.c],le[J]=P.x,le[J+1]=P.y,le[J+2]=P.z,le[J+3]=P.w,le[J+4]=k.x,le[J+5]=k.y,le[J+6]=k.z,le[J+7]=k.w,le[J+8]=O.x,le[J+9]=O.y,le[J+10]=O.z,le[J+11]=O.w,P=Ce[S.a],k=Ce[S.b],O=Ce[S.c],he[J]=P.x,he[J+1]=P.y,he[J+2]=P.z,he[J+3]=P.w,he[J+4]=k.x,he[J+5]=k.y,he[J+6]=k.z,he[J+7]=k.w,he[J+8]=O.x,he[J+9]=O.y,he[J+10]=O.z,he[J+11]=O.w,P=Se[S.a],k=Se[S.b],O=Se[S.c],ae[J]=P.x,ae[J+1]=P.y,ae[J+2]=P.z,ae[J+3]=1,ae[J+4]=k.x,ae[J+5]=k.y,ae[J+6]=k.z,ae[J+7]=1,ae[J+8]=O.x,ae[J+9]=O.y,ae[J+10]=O.z,ae[J+11]=1,P=Ae[S.a],k=Ae[S.b],O=Ae[S.c],se[J]=P.x,se[J+1]=P.y,se[J+2]=P.z,se[J+3]=1,se[J+4]=k.x,se[J+5]=k.y,se[J+6]=k.z,se[J+7]=1,se[J+8]=O.x,se[J+9]=O.y,se[J+10]=O.z,se[J+11]=1,J+=12),ve&&m&&(3==C.length&&m==THREE.VertexColors?(S=C[0],P=C[1],k=C[2]):k=P=S=F,oe[K]=S.r,oe[K+1]=S.g,oe[K+2]=S.b,oe[K+3]=P.r,oe[K+4]=P.g,oe[K+5]=P.b,oe[K+6]=k.r,oe[K+7]=k.g,oe[K+8]=k.b,K+=9),Re&&pe.hasTangents&&(C=L[0],F=L[1],S=L[2],ne[Z]=C.x,ne[Z+1]=C.y,ne[Z+2]=C.z,ne[Z+3]=C.w,ne[Z+4]=F.x,ne[Z+5]=F.y,ne[Z+6]=F.z,ne[Z+7]=F.w,ne[Z+8]=S.x,ne[Z+9]=S.y,ne[Z+10]=S.z,ne[Z+11]=S.w,Z+=12),_e&&_)if(3==M.length&&de)for(L=0;L<3;L++)A=M[L],re[q]=A.x,re[q+1]=A.y,re[q+2]=A.z,q+=3;else for(L=0;L<3;L++)re[q]=A.x,re[q+1]=A.y,re[q+2]=A.z,q+=3;if(Te&&void 0!==d&&E)for(L=0;L<3;L++)M=d[L],te[G]=M.u,te[G+1]=M.v,G+=2;if(Te&&void 0!==R&&E)for(L=0;L<3;L++)M=R[L],ie[X]=M.u,ie[X+1]=M.v,X+=2;ge&&(ue[Y]=W,ue[Y+1]=W+1,ue[Y+2]=W+2,Y+=3,Ee[Q]=W,Ee[Q+1]=W+1,Ee[Q+2]=W,Ee[Q+3]=W+2,Ee[Q+4]=W+1,Ee[Q+5]=W+2,Q+=6,W+=3)}else if(S instanceof THREE.Face4){if(me&&(w=xe[S.a].position,B=xe[S.b].position,D=xe[S.c].position,V=xe[S.d].position,ee[j]=w.x,ee[j+1]=w.y,ee[j+2]=w.z,ee[j+3]=B.x,ee[j+4]=B.y,ee[j+5]=B.z,ee[j+6]=D.x,ee[j+7]=D.y,ee[j+8]=D.z,ee[j+9]=V.x,ee[j+10]=V.y,ee[j+11]=V.z,j+=12),ce)for(N in ce)(k=ce[N]).__original.needsUpdate&&(P=k.offset,O=k.offsetSrc,1===k.size?(void 0===k.boundTo||"vertices"===k.boundTo?(k.array[P]=k.value[S.a],k.array[P+1]=k.value[S.b],k.array[P+2]=k.value[S.c],k.array[P+3]=k.value[S.d]):"faces"===k.boundTo?(O=k.value[O],k.array[P]=O,k.array[P+1]=O,k.array[P+2]=O,k.array[P+3]=O,k.offsetSrc++):"faceVertices"===k.boundTo&&(k.array[P]=k.value[O],k.array[P+1]=k.value[O+1],k.array[P+2]=k.value[O+2],k.array[P+3]=k.value[O+3],k.offsetSrc+=4),k.offset+=4):(void 0===k.boundTo||"vertices"===k.boundTo?(w=k.value[S.a],B=k.value[S.b],D=k.value[S.c],V=k.value[S.d]):"faces"===k.boundTo?(V=D=B=w=O=k.value[O],k.offsetSrc++):"faceVertices"===k.boundTo&&(w=k.value[O],B=k.value[O+1],D=k.value[O+2],V=k.value[O+3],k.offsetSrc+=4),2===k.size?(k.array[P]=w.x,k.array[P+1]=w.y,k.array[P+2]=B.x,k.array[P+3]=B.y,k.array[P+4]=D.x,k.array[P+5]=D.y,k.array[P+6]=V.x,k.array[P+7]=V.y,k.offset+=8):3===k.size?("c"===k.type?(k.array[P]=w.r,k.array[P+1]=w.g,k.array[P+2]=w.b,k.array[P+3]=B.r,k.array[P+4]=B.g,k.array[P+5]=B.b,k.array[P+6]=D.r,k.array[P+7]=D.g,k.array[P+8]=D.b,k.array[P+9]=V.r,k.array[P+10]=V.g,k.array[P+11]=V.b):(k.array[P]=w.x,k.array[P+1]=w.y,k.array[P+2]=w.z,k.array[P+3]=B.x,k.array[P+4]=B.y,k.array[P+5]=B.z,k.array[P+6]=D.x,k.array[P+7]=D.y,k.array[P+8]=D.z,k.array[P+9]=V.x,k.array[P+10]=V.y,k.array[P+11]=V.z),k.offset+=12):(k.array[P]=w.x,k.array[P+1]=w.y,k.array[P+2]=w.z,k.array[P+3]=w.w,k.array[P+4]=B.x,k.array[P+5]=B.y,k.array[P+6]=B.z,k.array[P+7]=B.w,k.array[P+8]=D.x,k.array[P+9]=D.y,k.array[P+10]=D.z,k.array[P+11]=D.w,k.array[P+12]=V.x,k.array[P+13]=V.y,k.array[P+14]=V.z,k.array[P+15]=V.w,k.offset+=16)));if(ye){for(P=0,k=Le.length;P<k;P++)w=Le[P].vertices[S.a].position,B=Le[P].vertices[S.b].position,D=Le[P].vertices[S.c].position,V=Le[P].vertices[S.d].position,(O=fe[P])[$]=w.x,O[$+1]=w.y,O[$+2]=w.z,O[$+3]=B.x,O[$+4]=B.y,O[$+5]=B.z,O[$+6]=D.x,O[$+7]=D.y,O[$+8]=D.z,O[$+9]=V.x,O[$+10]=V.y,O[$+11]=V.z;$+=12}if(Fe.length&&(P=Fe[S.a],k=Fe[S.b],O=Fe[S.c],I=Fe[S.d],le[J]=P.x,le[J+1]=P.y,le[J+2]=P.z,le[J+3]=P.w,le[J+4]=k.x,le[J+5]=k.y,le[J+6]=k.z,le[J+7]=k.w,le[J+8]=O.x,le[J+9]=O.y,le[J+10]=O.z,le[J+11]=O.w,le[J+12]=I.x,le[J+13]=I.y,le[J+14]=I.z,le[J+15]=I.w,P=Ce[S.a],k=Ce[S.b],O=Ce[S.c],I=Ce[S.d],he[J]=P.x,he[J+1]=P.y,he[J+2]=P.z,he[J+3]=P.w,he[J+4]=k.x,he[J+5]=k.y,he[J+6]=k.z,he[J+7]=k.w,he[J+8]=O.x,he[J+9]=O.y,he[J+10]=O.z,he[J+11]=O.w,he[J+12]=I.x,he[J+13]=I.y,he[J+14]=I.z,he[J+15]=I.w,P=Se[S.a],k=Se[S.b],O=Se[S.c],I=Se[S.d],ae[J]=P.x,ae[J+1]=P.y,ae[J+2]=P.z,ae[J+3]=1,ae[J+4]=k.x,ae[J+5]=k.y,ae[J+6]=k.z,ae[J+7]=1,ae[J+8]=O.x,ae[J+9]=O.y,ae[J+10]=O.z,ae[J+11]=1,ae[J+12]=I.x,ae[J+13]=I.y,ae[J+14]=I.z,ae[J+15]=1,P=Ae[S.a],k=Ae[S.b],O=Ae[S.c],S=Ae[S.d],se[J]=P.x,se[J+1]=P.y,se[J+2]=P.z,se[J+3]=1,se[J+4]=k.x,se[J+5]=k.y,se[J+6]=k.z,se[J+7]=1,se[J+8]=O.x,se[J+9]=O.y,se[J+10]=O.z,se[J+11]=1,se[J+12]=S.x,se[J+13]=S.y,se[J+14]=S.z,se[J+15]=1,J+=16),ve&&m&&(4==C.length&&m==THREE.VertexColors?(S=C[0],P=C[1],k=C[2],C=C[3]):C=k=P=S=F,oe[K]=S.r,oe[K+1]=S.g,oe[K+2]=S.b,oe[K+3]=P.r,oe[K+4]=P.g,oe[K+5]=P.b,oe[K+6]=k.r,oe[K+7]=k.g,oe[K+8]=k.b,oe[K+9]=C.r,oe[K+10]=C.g,oe[K+11]=C.b,K+=12),Re&&pe.hasTangents&&(C=L[0],F=L[1],S=L[2],L=L[3],ne[Z]=C.x,ne[Z+1]=C.y,ne[Z+2]=C.z,ne[Z+3]=C.w,ne[Z+4]=F.x,ne[Z+5]=F.y,ne[Z+6]=F.z,ne[Z+7]=F.w,ne[Z+8]=S.x,ne[Z+9]=S.y,ne[Z+10]=S.z,ne[Z+11]=S.w,ne[Z+12]=L.x,ne[Z+13]=L.y,ne[Z+14]=L.z,ne[Z+15]=L.w,Z+=16),_e&&_)if(4==M.length&&de)for(L=0;L<4;L++)A=M[L],re[q]=A.x,re[q+1]=A.y,re[q+2]=A.z,q+=3;else for(L=0;L<4;L++)re[q]=A.x,re[q+1]=A.y,re[q+2]=A.z,q+=3;if(Te&&void 0!==d&&E)for(L=0;L<4;L++)M=d[L],te[G]=M.u,te[G+1]=M.v,G+=2;if(Te&&void 0!==R&&E)for(L=0;L<4;L++)M=R[L],ie[X]=M.u,ie[X+1]=M.v,X+=2;ge&&(ue[Y]=W,ue[Y+1]=W+1,ue[Y+2]=W+3,ue[Y+3]=W+1,ue[Y+4]=W+2,ue[Y+5]=W+3,Y+=6,Ee[Q]=W,Ee[Q+1]=W+1,Ee[Q+2]=W,Ee[Q+3]=W+3,Ee[Q+4]=W+1,Ee[Q+5]=W+2,Ee[Q+6]=W+2,Ee[Q+7]=W+3,Q+=8,W+=4)}if(me&&(z.bindBuffer(z.ARRAY_BUFFER,f.__webglVertexBuffer),z.bufferData(z.ARRAY_BUFFER,ee,g)),ce)for(N in ce)(k=ce[N]).__original.needsUpdate&&(z.bindBuffer(z.ARRAY_BUFFER,k.buffer),z.bufferData(z.ARRAY_BUFFER,k.array,g));if(ye)for(P=0,k=Le.length;P<k;P++)z.bindBuffer(z.ARRAY_BUFFER,f.__webglMorphTargetsBuffers[P]),z.bufferData(z.ARRAY_BUFFER,fe[P],g);ve&&K>0&&(z.bindBuffer(z.ARRAY_BUFFER,f.__webglColorBuffer),z.bufferData(z.ARRAY_BUFFER,oe,g)),_e&&(z.bindBuffer(z.ARRAY_BUFFER,f.__webglNormalBuffer),z.bufferData(z.ARRAY_BUFFER,re,g)),Re&&pe.hasTangents&&(z.bindBuffer(z.ARRAY_BUFFER,f.__webglTangentBuffer),z.bufferData(z.ARRAY_BUFFER,ne,g)),Te&&G>0&&(z.bindBuffer(z.ARRAY_BUFFER,f.__webglUVBuffer),z.bufferData(z.ARRAY_BUFFER,te,g)),Te&&X>0&&(z.bindBuffer(z.ARRAY_BUFFER,f.__webglUV2Buffer),z.bufferData(z.ARRAY_BUFFER,ie,g)),ge&&(z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,f.__webglFaceBuffer),z.bufferData(z.ELEMENT_ARRAY_BUFFER,ue,g),z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,f.__webglLineBuffer),z.bufferData(z.ELEMENT_ARRAY_BUFFER,Ee,g)),J>0&&(z.bindBuffer(z.ARRAY_BUFFER,f.__webglSkinVertexABuffer),z.bufferData(z.ARRAY_BUFFER,ae,g),z.bindBuffer(z.ARRAY_BUFFER,f.__webglSkinVertexBBuffer),z.bufferData(z.ARRAY_BUFFER,se,g),z.bindBuffer(z.ARRAY_BUFFER,f.__webglSkinIndicesBuffer),z.bufferData(z.ARRAY_BUFFER,he,g),z.bindBuffer(z.ARRAY_BUFFER,f.__webglSkinWeightsBuffer),z.bufferData(z.ARRAY_BUFFER,le,g)),T&&(delete f.__inittedArrays,delete f.__colorArray,delete f.__normalArray,delete f.__tangentArray,delete f.__uvArray,delete f.__uv2Array,delete f.__faceArray,delete f.__vertexArray,delete f.__lineArray,delete f.__skinVertexAArray,delete f.__skinVertexBArray,delete f.__skinIndexArray,delete f.__skinWeightArray)}n.__dirtyVertices=!1,n.__dirtyMorphTargets=!1,n.__dirtyElements=!1,n.__dirtyUvs=!1,n.__dirtyNormals=!1,n.__dirtyTangents=!1,n.__dirtyColors=!1,y(s)}else if(o instanceof THREE.Ribbon){if((n=o.geometry).__dirtyVertices||n.__dirtyColors){if(o=n,s=z.DYNAMIC_DRAW,c=p=T=T=void 0,u=o.vertices,h=o.colors,E=u.length,f=h.length,m=o.__vertexArray,g=o.__colorArray,_=o.__dirtyColors,o.__dirtyVertices){for(T=0;T<E;T++)p=u[T].position,m[c=3*T]=p.x,m[c+1]=p.y,m[c+2]=p.z;z.bindBuffer(z.ARRAY_BUFFER,o.__webglVertexBuffer),z.bufferData(z.ARRAY_BUFFER,m,s)}if(_){for(T=0;T<f;T++)color=h[T],g[c=3*T]=color.r,g[c+1]=color.g,g[c+2]=color.b;z.bindBuffer(z.ARRAY_BUFFER,o.__webglColorBuffer),z.bufferData(z.ARRAY_BUFFER,g,s)}}n.__dirtyVertices=!1,n.__dirtyColors=!1}else if(o instanceof THREE.Line){if((n=o.geometry).__dirtyVertices||n.__dirtyColors){if(o=n,s=z.DYNAMIC_DRAW,c=p=T=T=void 0,u=o.vertices,h=o.colors,E=u.length,f=h.length,m=o.__vertexArray,g=o.__colorArray,_=o.__dirtyColors,o.__dirtyVertices){for(T=0;T<E;T++)p=u[T].position,m[c=3*T]=p.x,m[c+1]=p.y,m[c+2]=p.z;z.bindBuffer(z.ARRAY_BUFFER,o.__webglVertexBuffer),z.bufferData(z.ARRAY_BUFFER,m,s)}if(_){for(T=0;T<f;T++)color=h[T],g[c=3*T]=color.r,g[c+1]=color.g,g[c+2]=color.b;z.bindBuffer(z.ARRAY_BUFFER,o.__webglColorBuffer),z.bufferData(z.ARRAY_BUFFER,g,s)}}n.__dirtyVertices=!1,n.__dirtyColors=!1}else o instanceof THREE.ParticleSystem&&(f=v(n=o.geometry),(n.__dirtyVertices||n.__dirtyColors||o.sortParticles||f)&&t(n,z.DYNAMIC_DRAW,o),n.__dirtyVertices=!1,n.__dirtyColors=!1,y(n))},this.setFaceCulling=function(e,t){e?(t&&"ccw"!=t?z.frontFace(z.CW):z.frontFace(z.CCW),"back"==e?z.cullFace(z.BACK):"front"==e?z.cullFace(z.FRONT):z.cullFace(z.FRONT_AND_BACK),z.enable(z.CULL_FACE)):z.disable(z.CULL_FACE)},this.supportsVertexTextures=function(){return Te}},THREE.WebGLRenderTarget=function(e,t,i){this.width=e,this.height=t,i=i||{},this.wrapS=void 0!==i.wrapS?i.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==i.wrapT?i.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==i.magFilter?i.magFilter:THREE.LinearFilter,this.minFilter=void 0!==i.minFilter?i.minFilter:THREE.LinearMipMapLinearFilter,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==i.format?i.format:THREE.RGBAFormat,this.type=void 0!==i.type?i.type:THREE.UnsignedByteType,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer},THREE.WebGLRenderTarget.prototype.clone=function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e},THREE.WebGLRenderTargetCube=function(e,t,i){THREE.WebGLRenderTarget.call(this,e,t,i),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=new THREE.WebGLRenderTarget,THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;