THREE.EditorControls=function(e,t){function o(e){!1!==E.enabled&&(0===e.button?d=l.ROTATE:1===e.button?d=l.ZOOM:2===e.button&&(d=l.PAN),h.set(e.clientX,e.clientY),t.addEventListener("mousemove",n,!1),t.addEventListener("mouseup",r,!1),t.addEventListener("mouseout",r,!1),t.addEventListener("dblclick",r,!1))}function n(e){if(!1!==E.enabled){m.set(e.clientX,e.clientY);var t=m.x-h.x,o=m.y-h.y;d===l.ROTATE?E.rotate(new THREE.Vector3(.005*-t,.005*-o,0)):d===l.ZOOM?E.zoom(new THREE.Vector3(0,0,o)):d===l.PAN&&E.pan(new THREE.Vector3(-t,o,0)),h.set(e.clientX,e.clientY)}}function r(){t.removeEventListener("mousemove",n,!1),t.removeEventListener("mouseup",r,!1),t.removeEventListener("mouseout",r,!1),t.removeEventListener("dblclick",r,!1),d=l.NONE}function i(e){e.preventDefault();var t=0;e.wheelDelta?t=-e.wheelDelta:e.detail&&(t=10*e.detail),E.zoom(new THREE.Vector3(0,0,t))}function s(e){e.preventDefault()}function a(e){if(!1!==E.enabled){switch(e.touches.length){case 1:w[0].set(e.touches[0].pageX,e.touches[0].pageY,0),w[1].set(e.touches[0].pageX,e.touches[0].pageY,0);break;case 2:w[0].set(e.touches[0].pageX,e.touches[0].pageY,0),w[1].set(e.touches[1].pageX,e.touches[1].pageY,0),y=w[0].distanceTo(w[1])}R[0].copy(w[0]),R[1].copy(w[1])}}function c(e){function t(e,t){var o=t[0];for(var n in t)o.distanceTo(e)>t[n].distanceTo(e)&&(o=t[n]);return o}if(!1!==E.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:w[0].set(e.touches[0].pageX,e.touches[0].pageY,0),w[1].set(e.touches[0].pageX,e.touches[0].pageY,0),E.rotate(w[0].sub(t(w[0],R)).multiplyScalar(-.005));break;case 2:w[0].set(e.touches[0].pageX,e.touches[0].pageY,0),w[1].set(e.touches[1].pageX,e.touches[1].pageY,0),distance=w[0].distanceTo(w[1]),E.zoom(new THREE.Vector3(0,0,y-distance)),y=distance;var o=w[0].clone().sub(t(w[0],R)),n=w[1].clone().sub(t(w[1],R));o.x=-o.x,n.x=-n.x,E.pan(o.add(n).multiplyScalar(.5))}R[0].copy(w[0]),R[1].copy(w[1])}}t=void 0!==t?t:document,this.enabled=!0,this.center=new THREE.Vector3;var E=this,u=new THREE.Vector3,l={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},d=l.NONE,p=this.center,v=new THREE.Matrix3,m=new THREE.Vector2,h=new THREE.Vector2,T=new THREE.Spherical,g={type:"change"};this.focus=function(t,o){var n=new THREE.Vector3;if(t.matrixWorld.decompose(p,new THREE.Quaternion,n),o&&t.geometry){n=(n.x+n.y+n.z)/3,p.add(t.geometry.boundingSphere.center.clone().multiplyScalar(n));var r=t.geometry.boundingSphere.radius*n,i=e.position.clone().sub(p).normalize().multiplyScalar(2*r);e.position.copy(p).add(i)}e.lookAt(p),E.dispatchEvent(g)},this.pan=function(t){var o=e.position.distanceTo(p);t.multiplyScalar(.001*o),t.applyMatrix3(v.getNormalMatrix(e.matrix)),e.position.add(t),p.add(t),E.dispatchEvent(g)},this.zoom=function(t){var o=e.position.distanceTo(p);t.multiplyScalar(.001*o),t.length()>o||(t.applyMatrix3(v.getNormalMatrix(e.matrix)),e.position.add(t),E.dispatchEvent(g))},this.rotate=function(t){u.copy(e.position).sub(p),T.setFromVector3(u),T.theta+=t.x,T.phi+=t.y,T.makeSafe(),u.setFromSpherical(T),e.position.copy(p).add(u),e.lookAt(p),E.dispatchEvent(g)},this.dispose=function(){t.removeEventListener("contextmenu",s,!1),t.removeEventListener("mousedown",o,!1),t.removeEventListener("mousewheel",i,!1),t.removeEventListener("MozMousePixelScroll",i,!1),t.removeEventListener("mousemove",n,!1),t.removeEventListener("mouseup",r,!1),t.removeEventListener("mouseout",r,!1),t.removeEventListener("dblclick",r,!1),t.removeEventListener("touchstart",a,!1),t.removeEventListener("touchmove",c,!1)},t.addEventListener("contextmenu",s,!1),t.addEventListener("mousedown",o,!1),t.addEventListener("mousewheel",i,!1),t.addEventListener("MozMousePixelScroll",i,!1);new THREE.Vector3;var w=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],R=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],y=null;t.addEventListener("touchstart",a,!1),t.addEventListener("touchmove",c,!1)},THREE.EditorControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.EditorControls.prototype.constructor=THREE.EditorControls;