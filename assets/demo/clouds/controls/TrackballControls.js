THREE.TrackballControls=function(e,t){function o(e){!1!==E.enabled&&(window.removeEventListener("keydown",o),y=g,g===u.NONE&&(e.keyCode!==E.keys[u.ROTATE]||E.noRotate?e.keyCode!==E.keys[u.ZOOM]||E.noZoom?e.keyCode!==E.keys[u.PAN]||E.noPan||(g=u.PAN):g=u.ZOOM:g=u.ROTATE))}function n(){!1!==E.enabled&&(g=y,window.addEventListener("keydown",o,!1))}function s(e){!1!==E.enabled&&(e.preventDefault(),e.stopPropagation(),g===u.NONE&&(g=e.button),g!==u.ROTATE||E.noRotate?g!==u.ZOOM||E.noZoom?g!==u.PAN||E.noPan||(V.copy(q(e.pageX,e.pageY)),N.copy(V)):(O.copy(q(e.pageX,e.pageY)),R.copy(O)):(T.copy(F(e.pageX,e.pageY)),w.copy(T)),document.addEventListener("mousemove",i,!1),document.addEventListener("mouseup",c,!1),E.dispatchEvent(D))}function i(e){!1!==E.enabled&&(e.preventDefault(),e.stopPropagation(),g!==u.ROTATE||E.noRotate?g!==u.ZOOM||E.noZoom?g!==u.PAN||E.noPan||N.copy(q(e.pageX,e.pageY)):R.copy(q(e.pageX,e.pageY)):(w.copy(T),T.copy(F(e.pageX,e.pageY))))}function c(e){!1!==E.enabled&&(e.preventDefault(),e.stopPropagation(),g=u.NONE,document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",c),E.dispatchEvent(k))}function a(e){if(!1!==E.enabled){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),O.y+=.01*t,E.dispatchEvent(D),E.dispatchEvent(k)}}function r(e){if(!1!==E.enabled){if(1===e.touches.length)g=u.TOUCH_ROTATE,T.copy(F(e.touches[0].pageX,e.touches[0].pageY)),w.copy(T);else{g=u.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;L=H=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;V.copy(q(n,s)),N.copy(V)}E.dispatchEvent(D)}}function p(e){if(!1!==E.enabled)if(e.preventDefault(),e.stopPropagation(),1===e.touches.length)w.copy(T),T.copy(F(e.touches[0].pageX,e.touches[0].pageY));else{var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;L=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;N.copy(q(n,s))}}function h(e){if(!1!==E.enabled){switch(e.touches.length){case 0:g=u.NONE;break;case 1:g=u.TOUCH_ROTATE,T.copy(F(e.touches[0].pageX,e.touches[0].pageY)),w.copy(T)}E.dispatchEvent(k)}}function d(e){e.preventDefault()}var E=this,u={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var m=1e-6,l=new THREE.Vector3,g=u.NONE,y=u.NONE,v=new THREE.Vector3,w=new THREE.Vector2,T=new THREE.Vector2,f=new THREE.Vector3,b=0,O=new THREE.Vector2,R=new THREE.Vector2,H=0,L=0,V=new THREE.Vector2,N=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var j={type:"change"},D={type:"start"},k={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var A,P,C,M,X,Y,S,x,Z,z,_,q=(A=new THREE.Vector2,function(e,t){return A.set((e-E.screen.left)/E.screen.width,(t-E.screen.top)/E.screen.height),A}),F=function(){var e=new THREE.Vector2;return function(t,o){return e.set((t-.5*E.screen.width-E.screen.left)/(.5*E.screen.width),(E.screen.height+2*(E.screen.top-o))/E.screen.width),e}}();this.rotateCamera=(C=new THREE.Vector3,M=new THREE.Quaternion,X=new THREE.Vector3,Y=new THREE.Vector3,S=new THREE.Vector3,x=new THREE.Vector3,function(){x.set(T.x-w.x,T.y-w.y,0),(P=x.length())?(v.copy(E.object.position).sub(E.target),X.copy(v).normalize(),Y.copy(E.object.up).normalize(),S.crossVectors(Y,X).normalize(),Y.setLength(T.y-w.y),S.setLength(T.x-w.x),x.copy(Y.add(S)),C.crossVectors(x,v).normalize(),P*=E.rotateSpeed,M.setFromAxisAngle(C,P),v.applyQuaternion(M),E.object.up.applyQuaternion(M),f.copy(C),b=P):!E.staticMoving&&b&&(b*=Math.sqrt(1-E.dynamicDampingFactor),v.copy(E.object.position).sub(E.target),M.setFromAxisAngle(f,b),v.applyQuaternion(M),E.object.up.applyQuaternion(M)),w.copy(T)}),this.zoomCamera=function(){var e;g===u.TOUCH_ZOOM_PAN?(e=H/L,H=L,v.multiplyScalar(e)):1!==(e=1+(R.y-O.y)*E.zoomSpeed)&&e>0&&(v.multiplyScalar(e),E.staticMoving?O.copy(R):O.y+=(R.y-O.y)*this.dynamicDampingFactor)},this.panCamera=(Z=new THREE.Vector2,z=new THREE.Vector3,_=new THREE.Vector3,function(){Z.copy(N).sub(V),Z.lengthSq()&&(Z.multiplyScalar(v.length()*E.panSpeed),_.copy(v).cross(E.object.up).setLength(Z.x),_.add(z.copy(E.object.up).setLength(Z.y)),E.object.position.add(_),E.target.add(_),E.staticMoving?V.copy(N):V.add(Z.subVectors(N,V).multiplyScalar(E.dynamicDampingFactor)))}),this.checkDistances=function(){E.noZoom&&E.noPan||(v.lengthSq()>E.maxDistance*E.maxDistance&&(E.object.position.addVectors(E.target,v.setLength(E.maxDistance)),O.copy(R)),v.lengthSq()<E.minDistance*E.minDistance&&(E.object.position.addVectors(E.target,v.setLength(E.minDistance)),O.copy(R)))},this.update=function(){v.subVectors(E.object.position,E.target),E.noRotate||E.rotateCamera(),E.noZoom||E.zoomCamera(),E.noPan||E.panCamera(),E.object.position.addVectors(E.target,v),E.checkDistances(),E.object.lookAt(E.target),l.distanceToSquared(E.object.position)>m&&(E.dispatchEvent(j),l.copy(E.object.position))},this.reset=function(){g=u.NONE,y=u.NONE,E.target.copy(E.target0),E.object.position.copy(E.position0),E.object.up.copy(E.up0),v.subVectors(E.object.position,E.target),E.object.lookAt(E.target),E.dispatchEvent(j),l.copy(E.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",d,!1),this.domElement.removeEventListener("mousedown",s,!1),this.domElement.removeEventListener("mousewheel",a,!1),this.domElement.removeEventListener("MozMousePixelScroll",a,!1),this.domElement.removeEventListener("touchstart",r,!1),this.domElement.removeEventListener("touchend",h,!1),this.domElement.removeEventListener("touchmove",p,!1),document.removeEventListener("mousemove",i,!1),document.removeEventListener("mouseup",c,!1),window.removeEventListener("keydown",o,!1),window.removeEventListener("keyup",n,!1)},this.domElement.addEventListener("contextmenu",d,!1),this.domElement.addEventListener("mousedown",s,!1),this.domElement.addEventListener("mousewheel",a,!1),this.domElement.addEventListener("MozMousePixelScroll",a,!1),this.domElement.addEventListener("touchstart",r,!1),this.domElement.addEventListener("touchend",h,!1),this.domElement.addEventListener("touchmove",p,!1),window.addEventListener("keydown",o,!1),window.addEventListener("keyup",n,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;