<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Cloth Simulation | George Geng </title> <meta name="author" content="George Geng"> <meta name="description" content="Cloth simulation using a point mass-spring system, along with various GLSL shaders."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.png?98ab68992a4209ac66024f789453914e"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://jorjboi.github.io/projects/cloth_sim/"> <script src="/assets/js/theme.js?55d5d4529bf41e3d82d02583f9ba3ba0"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">George</span> Geng </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/art/">art </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Cloth Simulation</h1> <p class="post-description">Cloth simulation using a point mass-spring system, along with various GLSL shaders.</p> </header> <article> <script type="text/javascript" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script> <p><strong>Under construction!</strong></p> <ul> <li><a href="#overview">Overview</a></li> <li><a href="#mass-spring-system">Mass-Spring System</a></li> <li><a href="#numerical-integration">Numerical Integration</a></li> <li><a href="#collision-handling">Collision Handling</a></li> <li><a href="#self-collisions">Self-Collisions</a></li> </ul> <h2 id="overview">Overview</h2> <p>Cloth can be simulated with a 2D grid of point masses connected by springs, as outlined in this <a href="https://www.cs.rpi.edu/~cutler/classes/advancedgraphics/S14/papers/provot_cloth_simulation_96.pdf" rel="external nofollow noopener" target="_blank">1995 SIGGRAPH paper</a>. The motion of each mass is governed by the net force from external forces (e.g. gravity) and internal spring forces. The position of each mass at any point in time can be found using the laws of motion and numerical integration techniques.</p> <p>Here, I implement this mass-spring system and accelerate neighbor detection and collision handling with spatial hashing. I also implement several GLSL shaders to texture the cloth with different effects.</p> <h2 id="mass-spring-system">Mass-Spring System</h2> <p>Our model for the cloth is an <code class="language-plaintext highlighter-rouge">m x n</code> grid of identical masses connected by massless springs. There are 3 different types of spring constraints:</p> <ol> <li> <strong>Structural constraints</strong> exist between a mass <code class="language-plaintext highlighter-rouge">[i, j]</code> and masses <code class="language-plaintext highlighter-rouge">[i + 1, j]</code> and <code class="language-plaintext highlighter-rouge">[i, j + 1]</code>. They help define the topology of the cloth and simulate “stretching” stresses on the cloth.</li> <li> <strong>Shearing constraints</strong> exist between a mass <code class="language-plaintext highlighter-rouge">[i, j]</code> and masses <code class="language-plaintext highlighter-rouge">[i - 1, j - 1]</code> and <code class="language-plaintext highlighter-rouge">[i - 1, j + 1]</code>. They help prevent excessive shearing deformation and prevent the grid from collapsing entirely onto one side.</li> <li> <strong>Bending constraints</strong> exist between a mass <code class="language-plaintext highlighter-rouge">[i, j]</code> and masses <code class="language-plaintext highlighter-rouge">[i + 2, j]</code> and <code class="language-plaintext highlighter-rouge">[i, j + 2]</code>. They simulate smooth “bending” on the cloth and prevent the grid from folding perfectly onto itself like an infinitely thin sheet of paper.</li> </ol> <div class="row justify-content-sm-center"> <div class="col-sm-4 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" sizes="95vw"></source> <img src="/assets/img/clothsim/structural.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> Structural and bending constraints </div> </div> <div class="col-sm-4 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" sizes="95vw"></source> <img src="/assets/img/clothsim/shearing.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> Shearing constraints </div> </div> </div> <p>The grid with all the spring constraints between point masses set up is shown below:</p> <div class="row justify-content-center"> <div class="col-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" sizes="95vw"></source> <img src="/assets/img/clothsim/all_constraints.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Decoder pipeline" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Mass-spring grid </div> <h2 id="numerical-integration">Numerical Integration</h2> <p>The total force acting on a mass at any instant can be found by first applying any external forces and then the forces from the spring constraints. I do this by looping over all the springs and calculating the force a spring exerts on the masses at either end using Hooke’s Law:</p> \[F_s = k_s * (\| p_a - p_b \| - l)\] <p>where \(k_s\) is the spring constant, \(p_a\) and \(p_b\) are the positions of the two end masses <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> respectively, and \(l\) is the spring’s rest length. For flexion constraints, I also scale the force by 0.2 to keep them weaker than structural or shearing constraints.</p> <p>Using the net force on each mass and numerical integration, I can find the change in each mass’s position at every time step \(dt\). Here, I use <strong>Verlet Integration</strong>. Given a particle position \(x_t\), its current velocity \(v_t\), and its acceleration \(a_t\), we calculate the next position \(x_{t + dt}\) as:</p> \[x_{t + dt} = x_t + v_tdt + a_tdt^2\] <p>We find \(a_t\) by diving the net force by the mass and can approximate \(v_tdt\) as \(x_t – x_{t - dt}\):</p> \[x_{t + dt} = x_t + (x_t – x_{t - dt}) + a_tdt^2\] <p>Finally, we introduce a damping term \(d\) to simulate energy loss over time from friction.</p> \[x_{t + dt} = x_t + (1 - d)(x_t – x_{t - dt}) + a_tdt^2\] <p>Additionally, the positions were constrained so that the spring was never elongated by more than 10%. If it exceeds 10%, I adjust the positions of the masses to satisfy the constraint. The adjustment is shared equally between two masses unless one of them is pinned, in which case the entire adjustment goes to the unpinned mass.</p> <h2 id="collision-handling">Collision Handling</h2> <p>We can simulate collisions with external objects such as a sphere or plane. In either case, if I detect that the location of the mass passes through the surface of the geometry, I “bump” it back up to the surface of the object.</p> <p>Specifically, for a sphere we find a correction vector that goes from the sphere’s origin to the position of the point mass. For a plane, the correction vector goes from the mass’s last position to a point where the mass should have intersected from the plane if it had traveled from its current position in a straight line to the surface of the plane.</p> <p>We apply a \((1 - f)\) scaling factor to the correction vector to account for loss of energy from friction.</p> \[p_t = (1 - f) * correction\text{_}vector + p_{t – dt}\] <p>Here are the results of running the cloth collision test with a sphere. As we increase \(k_s\), the stretchiness factor of the cloth, we see that it maintains more of its shape and becomes more rigid.</p> <p>Here is the cloth lying on a plane:</p> <h2 id="self-collisions">Self-Collisions</h2> <p>To prevent the cloth from folding over and intersecting with itself, we also need to handle self-collisions. The naive \(O(n^2))\ way of doing this would be to check if every mass is about to collide with every other mass in the grid at every time step, but this is too inefficient for real-time simulations.</p> <p>Instead, I implement spatial hashing. I subdivide the entire space into the scene into equally sized 3D boxes, map each box to a unique float, and then build a hash table from each float to a list of point masses located in the box. Then, at every time step, I only need to build the hash table and iterate through the point masses. For each point mass, I use the hash table to find a list of neighboring point masses in the same 3D volume and check for collisions between each point mass and its neighbors.</p> <p>For mapping a 3D volume to a float, I take the coordinates of the box \((x, y, z)\) and return \(p^2x + py + z\), where \(p\) is a sufficiently large prime number. Because \(p\) is prime, \(p^2\), \(p\), and \(1\) are unlikely to have any linear combinations that produce the same value. A large enough prime creates a larger separation between \(p^2\), \(p\), and \(1\), which reduces the risk of collisions for large ranges of \((x, y, z)\).</p> <p>To see if two point masses are about to collide, I check if they are \(2 * cloth\text{_}thicknesses\) apart and apply a correction vector to ensure they are. The final correction vector applied to each point mass is the average of all correction vectors from its neighboring point masses, scaled down by the number of simulation steps to avoid too many sudden position corrections.</p> <p>Below are the results of the cloth falling onto itself:</p> <p>Note that as we increase the spring constant \(k_s\), the cloth folds upon itself fewer times because it simulates a stiffer fabric.</p> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?70d799092f862ad98c7876aa47712e20"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>